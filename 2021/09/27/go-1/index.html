<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="惊鸿一瞥Hello，World123456789package main	import &amp;#123;	&quot;fmt&quot;&amp;#125;func main() &amp;#123;	fmt.Println(&quot;Hello, World!&quot;)&amp;#125; package关键字声明代码所属的包，本例中包名为main。import关键字导入需要的包func关键字声明函数当运行一个Go程">
<meta property="og:type" content="article">
<meta property="og:title" content="go(1)">
<meta property="og:url" content="http://example.com/2021/09/27/go-1/index.html">
<meta property="og:site_name" content="Las Nubes">
<meta property="og:description" content="惊鸿一瞥Hello，World123456789package main	import &amp;#123;	&quot;fmt&quot;&amp;#125;func main() &amp;#123;	fmt.Println(&quot;Hello, World!&quot;)&amp;#125; package关键字声明代码所属的包，本例中包名为main。import关键字导入需要的包func关键字声明函数当运行一个Go程">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210610202812183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMTAyMzUw,size_16,color_FFFFFF,t_70">
<meta property="article:published_time" content="2021-09-27T11:49:50.000Z">
<meta property="article:modified_time" content="2021-09-30T07:19:25.552Z">
<meta property="article:author" content="GuiYoung">
<meta property="article:tag" content="go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20210610202812183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMTAyMzUw,size_16,color_FFFFFF,t_70">

<link rel="canonical" href="http://example.com/2021/09/27/go-1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>go(1) | Las Nubes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Las Nubes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/27/go-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          go(1)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-09-27 19:49:50" itemprop="dateCreated datePublished" datetime="2021-09-27T19:49:50+08:00">2021-09-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-09-30 15:19:25" itemprop="dateModified" datetime="2021-09-30T15:19:25+08:00">2021-09-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="惊鸿一瞥"><a href="#惊鸿一瞥" class="headerlink" title="惊鸿一瞥"></a>惊鸿一瞥</h1><h2 id="Hello，World"><a href="#Hello，World" class="headerlink" title="Hello，World"></a>Hello，World</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main	</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>package关键字声明代码所属的包，本例中包名为main。<br>import关键字导入需要的包<br>func关键字声明函数<br>当运行一个Go程序，总是从main包的main函数开始</p>
<p>fmt包：format之缩写，提供格式化输入输出函数</p>
<p>此外，大括号有其唯一的制定格式</p>
<h2 id="基本知识"><a href="#基本知识" class="headerlink" title="基本知识"></a>基本知识</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//声明常量</span></span><br><span class="line">	<span class="keyword">const</span> ( days = <span class="number">365</span></span><br><span class="line">           name = <span class="string">&quot;days&quot;</span></span><br><span class="line">          )</span><br><span class="line">	<span class="comment">//声明变量</span></span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		dream = <span class="string">&quot;I have a dream&quot;</span></span><br><span class="line">		new_dream = <span class="string">&quot;I had a dream&quot;</span></span><br><span class="line">	)</span><br><span class="line">	<span class="comment">//格式化输出</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;One year has&quot;</span>,days,name)</span><br><span class="line">	fmt.Print(<span class="string">&quot;One year has &quot;</span>)</span><br><span class="line">	fmt.Print(days)</span><br><span class="line">	fmt.Print(<span class="string">&quot; days\n&quot;</span>)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;One year has %d days\n&quot;</span>,days)</span><br><span class="line">	fmt.Println(dream,<span class="string">&quot;\n&quot;</span>,new_dream)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Println会自动补换行符</p>
<p>Go中运算符和C中大抵相同，但没有++count这种前置增量操作</p>
<h2 id="基本控制结构"><a href="#基本控制结构" class="headerlink" title="基本控制结构"></a>基本控制结构</h2><p>在go中，true是唯一真值，false是唯一假值</p>
<p>比较运算符：==,!=,&lt;=,&lt;,&gt;=,&gt;</p>
<p>Go不允许文本和数值直接比较</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> 判断语句&#123;</span><br><span class="line">		<span class="comment">//do sth.</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> 判断语句&#123;</span><br><span class="line">		<span class="comment">//do sth.</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> 判断语句&#123;</span><br><span class="line">		<span class="comment">//do sth.</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>逻辑与：&amp;&amp;<br>逻辑或：||<br>逻辑非：！</p>
<p>Switch实现分支判断：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">const</span> days = <span class="number">365</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> days &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">100</span>:</span><br><span class="line">		fmt.Println(<span class="number">100</span>,<span class="string">&quot;days&quot;</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="number">200</span>,<span class="number">365</span>:<span class="comment">//使用逗号分隔多个可选值</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;hhhh&quot;</span>)</span><br><span class="line">		<span class="keyword">fallthrough</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">&quot;23333333&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>for实现循环结构<br>关于range关键字：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//假设array_cut是一个数组或切片</span></span><br><span class="line"><span class="comment">//index和value分别对应了下标和值</span></span><br><span class="line"><span class="keyword">for</span> index,value := <span class="keyword">range</span> array_cut&#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>go作用域：以大括号分界<br>虽然没有用到大括号，但default和case都i引入了新的作用域</p>
<p>简短声明：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//两方法等价</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;ubuntu&#x27;</span></span><br><span class="line">name := <span class="string">&#x27;ubuntu&#x27;</span></span><br></pre></td></tr></table></figure>

<p>简短声明作用：<br>以下三种情况，变量作用域都在大括号内<br>这种使用方法无法用var声明替代</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> count := <span class="number">10</span>; count &gt; <span class="number">0</span>;count--&#123;</span><br><span class="line">	<span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> count := rand.Intn(<span class="number">3</span>); count == <span class="number">0</span>&#123;</span><br><span class="line">	<span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> num := rand(<span class="number">10</span>); num&#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h1><h2 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//双精度浮点数</span></span><br><span class="line">age := <span class="number">19.2</span></span><br><span class="line"><span class="keyword">var</span> age =<span class="number">19.2</span></span><br><span class="line"><span class="keyword">var</span> age <span class="keyword">float64</span> = <span class="number">19.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//单精度浮点数</span></span><br><span class="line"><span class="keyword">var</span> age <span class="keyword">float32</span> = <span class="number">19.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//默认零值</span></span><br><span class="line"><span class="keyword">var</span> age</span><br></pre></td></tr></table></figure>

<h2 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">year := <span class="number">2021</span></span><br><span class="line"><span class="keyword">var</span> year = <span class="number">2021</span></span><br><span class="line"><span class="keyword">var</span> year <span class="keyword">int</span> <span class="number">2021</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//e12表示10的12次方</span></span><br><span class="line"><span class="keyword">var</span> distance <span class="keyword">int64</span>  = <span class="number">2.33e12</span></span><br></pre></td></tr></table></figure>

<h2 id="big包"><a href="#big包" class="headerlink" title="big包"></a>big包</h2><p>big包提供3种类型：</p>
<ul>
<li>存储大整数big.Int</li>
<li>存储任意精度浮点数big.Float</li>
<li>存储分数big.Rat</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建int64类型</span></span><br><span class="line">hhhhh := big.NewInt(<span class="number">2333333</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建很大很大的数</span></span><br><span class="line">hhhhhhh := <span class="built_in">new</span>(big.Int)</span><br><span class="line">hhhhhhh.SetString(<span class="string">&quot;23333333333333333&quot;</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Go语言不会为常量推断类型，而是默认无类型（untyped）</span></span><br><span class="line"><span class="comment">//由big包提供底层支持</span></span><br><span class="line"><span class="keyword">const</span> distance = <span class="number">23333333333333333333333333</span></span><br></pre></td></tr></table></figure>

<h2 id="多语言文本"><a href="#多语言文本" class="headerlink" title="多语言文本"></a>多语言文本</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go语言推断双引号内字面值为string类型</span></span><br><span class="line">peace := <span class="string">&quot;peace&quot;</span></span><br><span class="line"><span class="keyword">var</span> peace = <span class="string">&quot;peace&quot;</span></span><br><span class="line"><span class="keyword">var</span> peace <span class="keyword">string</span> = <span class="string">&quot;peace&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//声明零值</span></span><br><span class="line"><span class="keyword">var</span> peace <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//反引号包围的文本不考虑转义字符`</span></span><br><span class="line"><span class="keyword">var</span> peace <span class="string">&#x27;hhhhhhh\n&#x27;</span><span class="comment">//不会输出换行符，而是输出/n</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//反引号可跨越多行，打印时将包含这些行</span></span><br><span class="line"><span class="keyword">var</span> peace <span class="string">&#x27;hhhhh</span></span><br><span class="line"><span class="string">hhhhhhhh</span></span><br><span class="line"><span class="string">hhhhh&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以独立访问字符串中的单个字符，但无法单独修改</span></span><br><span class="line">hhhh = <span class="string">&#x27;laugh&#x27;</span></span><br><span class="line">h = laugh[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//非法操作：</span></span><br><span class="line">laugh[<span class="number">4</span>] = <span class="string">&#x27;d&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><p>类型转换：<br>转换一个变量，只需用与目标类型同名的函数来包裹该变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字符串拼接</span></span><br><span class="line">hhhh = <span class="string">&#x27;laugh &#x27;</span> + <span class="string">&#x27;is the power of birth.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//非法：</span></span><br><span class="line">hhh =<span class="string">&#x27;laugh &#x27;</span> + <span class="string">&#x27;is the power of birth.&#x27;</span> + <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//合法</span></span><br><span class="line">hhh = <span class="string">&#x27;laugh &#x27;</span> + <span class="string">&#x27;is the power of birth.&#x27;</span> + <span class="string">&#x27;10&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这部分与c语言大致相同<br>浮点数转换为整数，没有任何舍入，而是直接截断</p>
<p>关于字符串转换</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据代码点转换</span></span><br><span class="line">fmt.Println(<span class="keyword">string</span>(<span class="number">960</span>),<span class="keyword">string</span>(<span class="number">940</span>),<span class="keyword">string</span>(<span class="number">969</span>),<span class="keyword">string</span>(<span class="number">33</span>))</span><br><span class="line"><span class="comment">//输出π ά ω !</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//转换为字符串方法：</span></span><br><span class="line"><span class="comment">//使用strconv包的Itoa函数</span></span><br><span class="line">hhh =<span class="string">&#x27;laugh &#x27;</span> + <span class="string">&#x27;is the power of birth.&#x27;</span> + strconv.Itoa(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//字符串转换为整数</span></span><br><span class="line"><span class="comment">//使用strconv包的Atoi函数</span></span><br><span class="line"><span class="keyword">const</span> hhh <span class="keyword">string</span> = <span class="string">&#x27;23333&#x27;</span></span><br><span class="line">number := strconv.Atoi(hhh)</span><br></pre></td></tr></table></figure>
<p>代码点：<br>一个数字对应一个特殊字符<br>如：π ά ω !分别对应960 940 969 33</p>
<h1 id="构建块"><a href="#构建块" class="headerlink" title="构建块"></a>构建块</h1><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>基本格式：</p>
<blockquote>
<p><code>func function_name( [parameter list] ) [return_types] &#123; 函数体 &#125;</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(number1 <span class="keyword">int</span>,number2 <span class="keyword">int</span>)</span><span class="params">(sum <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	sum = number1 + number2</span><br><span class="line">	<span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(number1 <span class="keyword">int</span>,number2 <span class="keyword">int</span>)</span><span class="params">(sum <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	sum = number1 + number2</span><br><span class="line">	<span class="keyword">return</span> <span class="comment">//省略了返回值的名字</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Calculate</span><span class="params">(number1 ,number2 <span class="keyword">int</span>)</span><span class="params">(sum,multitude <span class="keyword">int</span>)</span></span>&#123;<span class="comment">//减少了int的使用次数</span></span><br><span class="line">	sum = number1 + number2</span><br><span class="line">	multitude = number2*number1</span><br><span class="line">	<span class="keyword">return</span> sum,multitude</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Calculate</span><span class="params">(number1 ,number2 <span class="keyword">int</span>)</span><span class="params">(sum,multitude <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	sum = number1 + number2</span><br><span class="line">	multitude = number2*number1</span><br><span class="line">	<span class="keyword">return</span> </span><br></pre></td></tr></table></figure>

<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>声明新类型：<br>格式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> 新类型名称 底层类型</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> type1 <span class="keyword">float64</span></span><br><span class="line"><span class="keyword">type</span> type2 <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> number1 type1 := <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> number2 type2 := <span class="number">15</span></span><br><span class="line"><span class="keyword">var</span> number3 <span class="keyword">float64</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//以下操作非法.尽管底层相同，他们仍为不同的类型</span></span><br><span class="line">numebr1 = number2</span><br><span class="line">number2 = number3</span><br></pre></td></tr></table></figure>

<p>在go语言中，没有类和对象<br>格式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(接受者)</span> 方法名<span class="params">(形参列表)</span> （返回值列表）</span>&#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接受者是某种非内置类型的变量<br>用于建立类型和方法之间的关联</p>
<p>实例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(number1 myInt)</span> <span class="title">calculate</span><span class="params">(number2 <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>,multitude <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">int</span>(number1)+number2,<span class="keyword">int</span>(number1)*number2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> number1 myInt = <span class="number">10</span></span><br><span class="line">	<span class="keyword">var</span> number2 =<span class="number">20</span></span><br><span class="line">	<span class="keyword">var</span> sum <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">var</span> multitude <span class="keyword">int</span></span><br><span class="line">	sum,multitude = number1.calculate(number2)</span><br><span class="line">	fmt.Println(sum,multitude)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一等函数"><a href="#一等函数" class="headerlink" title="一等函数"></a>一等函数</h2><p>在go中，函数是 一等 值，可以把函数赋值给变量，可以把函数传递给函数，也可以编写创建并返回函数的函数。</p>
<p>将函数赋值给变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(number1,number2 <span class="keyword">int</span>)</span> <span class="title">myInt</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> myInt(number1+number2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Multitude</span><span class="params">(number1,number2 <span class="keyword">int</span>)</span> <span class="title">myInt</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> myInt(number1*number2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//将函数赋值给变量方法一：</span></span><br><span class="line">	func1 := Add</span><br><span class="line">	<span class="comment">//将函数赋值给变量方法二</span></span><br><span class="line">	<span class="keyword">var</span> func2 <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span> <span class="title">myInt</span> = <span class="title">Multitude</span></span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> number1 <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">	<span class="keyword">var</span> number2 <span class="keyword">int</span> = <span class="number">20</span></span><br><span class="line">	<span class="keyword">var</span> result myInt</span><br><span class="line"></span><br><span class="line">	result = func1(number1,number2)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">	result = func2(number1,number2)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line"></span><br><span class="line">	func1 = func2</span><br><span class="line">	result = func1(number1,number2)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">	func2 = Add</span><br><span class="line">	result = func2(number1,number2)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将函数传递给其他函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int64</span></span><br><span class="line"><span class="comment">//声明函数类型</span></span><br><span class="line"><span class="keyword">type</span> myFunc <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span> <span class="title">myInt</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(number1,number2 <span class="keyword">int</span>)</span> <span class="title">myInt</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> myInt(number1+number2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Multitude</span><span class="params">(number1,number2 <span class="keyword">int</span>)</span> <span class="title">myInt</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> myInt(number1*number2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add_Multitude</span><span class="params">(number1,number2 <span class="keyword">int</span>, func1,func2 myFunc)</span> <span class="params">(sum,multitude myInt)</span></span>&#123;</span><br><span class="line">	sum = func1(number1,number2)</span><br><span class="line">	multitude = func2(number1,number2)</span><br><span class="line">	<span class="keyword">return</span> sum,multitude</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="闭包和匿名函数"><a href="#闭包和匿名函数" class="headerlink" title="闭包和匿名函数"></a>闭包和匿名函数</h2><p>匿名函数在Go中也称为函数字面量</p>
<p>闭包函数：声明在一个函数内部的函数<br>闭包：内部函数总是可以访问其所在外部函数中的变量，即使它所在的外部函数已返回（寿命终结）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> myFunc <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func1</span><span class="params">(func2 myFunc,offset <span class="keyword">int</span>)</span> <span class="title">myFunc</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> func2() + offset</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func2</span><span class="params">()</span> <span class="title">int</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//匿名函数赋值给变量</span></span><br><span class="line">	func4 := <span class="function"><span class="keyword">func</span><span class="params">(message <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">		fmt.Println(message)</span><br><span class="line">	&#125;</span><br><span class="line">	func4(<span class="string">&quot;hhhhhhhhhhhhhhhhhhhhhhh&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//同时声明和调用匿名函数</span></span><br><span class="line">	<span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;hhhhhhhhh&quot;</span>)</span><br><span class="line">	&#125; ()</span><br><span class="line"></span><br><span class="line">	<span class="comment">//从函数里返回另一个函数</span></span><br><span class="line">	func3 := func1(func2,<span class="number">20</span>)</span><br><span class="line">	fmt.Println(func3())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="可变参数函数"><a href="#可变参数函数" class="headerlink" title="可变参数函数"></a>可变参数函数</h2><p><img src="https://img-blog.csdnimg.cn/20210610202812183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMTAyMzUw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>声明放在函数形参的最后一位<br>可以传入多个参数或不传参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(name...<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cut_test := []<span class="keyword">string</span>&#123;<span class="string">&quot;sss&quot;</span>,<span class="string">&quot;hhh&quot;</span>,<span class="string">&quot;2333&quot;</span>&#125;</span><br><span class="line"><span class="comment">//将cut_test的多个元素传递给函数</span></span><br><span class="line">cut = f(cut_test..)</span><br></pre></td></tr></table></figure>



<h1 id="收集器"><a href="#收集器" class="headerlink" title="收集器"></a>收集器</h1><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> planests [<span class="number">8</span>]<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">planest[<span class="number">0</span>] = <span class="string">&quot;Mercury&quot;</span></span><br><span class="line">mercury := planets[<span class="number">0</span>]</span><br><span class="line">fmt.Println(<span class="built_in">len</span>(planest))<span class="comment">//输出8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//未赋值的元素将默认为零值</span></span><br><span class="line"><span class="keyword">var</span> numbers = [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//也可以不用指定数组长度</span></span><br><span class="line"><span class="keyword">var</span> numbers = [...]<span class="keyword">int</span>&#123;</span><br><span class="line"><span class="number">1</span>,</span><br><span class="line"><span class="number">2</span>,</span><br><span class="line"><span class="number">3</span>,</span><br><span class="line">&#125;<span class="comment">//结尾逗号是必需的</span></span><br></pre></td></tr></table></figure>
<p>数组用于赋值或传递给参数时会产生一个副本<br>故函数内部对数组的修改不会影响原数组</p>
<p>数组嵌套定义即形成所谓的多维数组</p>
<h2 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h2><ul>
<li>对于数组</li>
</ul>
<p>切片数组不会导致数组被修改，只是创建了指向数组的视图，把该视图称为切片类型</p>
<p>格外注意的是，切片或切片的切片都是数组的视图，对他们进行修改会导致原数组的修改</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sort&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	numbers := [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">	cut1 := numbers[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">	cut2 := numbers[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">	fmt.Println(numbers,cut1,cut2)</span><br><span class="line">	cut2[<span class="number">1</span>] = <span class="number">100</span></span><br><span class="line">	fmt.Println(numbers)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//可以切割string类型，将创建另一个字符串，两个字符串相互独立</span></span><br><span class="line">	name  := <span class="string">&quot;yangzi&quot;</span></span><br><span class="line">	name1 := name[:<span class="number">4</span>]</span><br><span class="line">	fmt.Println(name,name1)</span><br><span class="line">    <span class="comment">// name 和 name1 都不会改变</span></span><br><span class="line">	name = <span class="string">&quot;hhhhh&quot;</span></span><br><span class="line">	fmt.Println(name,name1) </span><br><span class="line">    name1 = <span class="string">&quot;233333&quot;</span></span><br><span class="line">	fmt.Println(name,name1)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建完全切片方法一：</span></span><br><span class="line">	<span class="comment">//numbers2 := numebrs[:]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建完全切片方法二：</span></span><br><span class="line">	numbers3 := []<span class="keyword">string</span>&#123;<span class="string">&quot;11&quot;</span>,<span class="string">&quot;40&quot;</span>,<span class="string">&quot;ann&quot;</span>,<span class="string">&quot;ccc&quot;</span>,<span class="string">&quot;bbbb&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//切片可以带有方法，纯数组不行</span></span><br><span class="line">	sort.StringSlice(numbers3).Sort()</span><br><span class="line">	fmt.Println(numbers3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>关于sort：<br>标准库sort包声明了一种StringSlice类型：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> StringSlice []<span class="keyword">string</span></span><br></pre></td></tr></table></figure>

<p>该类型还有关联的Sort方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p StringSlice)</span> <span class="title">Sort</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p>Go语言通过切片和append函数来实现动态数组的功能</p>
<p>切片长度：切片中可见元素的数量<br>切片容量：切片的底层数组决定了切片的容量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//切片的底层数组长度为5</span></span><br><span class="line">	<span class="comment">//切片长度为5,容量为5</span></span><br><span class="line">	vocabulary := []<span class="keyword">string</span>&#123;<span class="string">&quot;terminally&quot;</span>,<span class="string">&quot;visible&quot;</span>,<span class="string">&quot;lethal&quot;</span>,<span class="string">&quot;legally&quot;</span>,<span class="string">&quot;prescribe&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//此时，append函数将切片元素复制到新创建的数组里面并将新创建的数组作为切片的底层数组，该数组长度为原底层数组的两倍</span></span><br><span class="line">	<span class="comment">//切片长度为8,容量为10</span></span><br><span class="line">	vocabulary = <span class="built_in">append</span>(vocabulary,<span class="string">&quot;partnership&quot;</span>,<span class="string">&quot;compassion&quot;</span>,<span class="string">&quot;publication&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//三索引切片操作：</span></span><br><span class="line">	<span class="comment">//三索引操作旨在避免对底层数组的修改</span></span><br><span class="line">	arry_vocabulary := [...]<span class="keyword">string</span>&#123;<span class="string">&quot;candidness&quot;</span>,<span class="string">&quot;dose&quot;</span>,<span class="string">&quot;medication&quot;</span>,<span class="string">&quot;constitutionally&quot;</span>,<span class="string">&quot;uphold&quot;</span>,<span class="string">&quot;legislation&quot;</span>,&#125;</span><br><span class="line">	<span class="comment">//切片长度为4,容量为4</span></span><br><span class="line">	cut_vocabulary := arry_vocabulary[<span class="number">0</span>:<span class="number">4</span>:<span class="number">4</span>]</span><br><span class="line">	fmt.Println(cut_vocabulary)</span><br><span class="line">	cut_vocabulary = <span class="built_in">append</span>(cut_vocabulary,<span class="string">&quot;spark&quot;</span>)</span><br><span class="line">	fmt.Println(cut_vocabulary)</span><br><span class="line">	fmt.Println(arry_vocabulary)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//两索引</span></span><br><span class="line">	<span class="comment">//长度为2,容量为6（与底层数组相同），可以看到底层数组仍未被修改</span></span><br><span class="line">	cut_vocabulary2 := arry_vocabulary[<span class="number">0</span>:<span class="number">4</span>]</span><br><span class="line">	cut_vocabulary2 = <span class="built_in">append</span>(arry_vocabulary[:],<span class="string">&quot;notable&quot;</span>)</span><br><span class="line">	fmt.Println(cut_vocabulary2)</span><br><span class="line">	fmt.Println(arry_vocabulary)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//三索引但容量大于长度</span></span><br><span class="line">	cut_vocabulary3 := arry_vocabulary[<span class="number">0</span>:<span class="number">4</span>:<span class="number">5</span>]</span><br><span class="line">	cut_vocabulary3 = <span class="built_in">append</span>(cut_vocabulary,<span class="string">&quot;spark&quot;</span>)</span><br><span class="line">	fmt.Println(cut_vocabulary3)</span><br><span class="line">	fmt.Println(arry_vocabulary)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用make函数对切片容量实行预分配</span></span><br><span class="line">	<span class="comment">//切片长度为0,容量为10</span></span><br><span class="line">	test_cut1 := <span class="built_in">make</span>([]<span class="keyword">string</span>,<span class="number">0</span>,<span class="number">10</span>)</span><br><span class="line">	test_cut1 = <span class="built_in">append</span>(test_cut1,<span class="string">&quot;hhhhhhhhhhhhhh&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//切片长度为10,容量为10,元素默认为零值</span></span><br><span class="line">	test_cut2 := <span class="built_in">make</span>([]<span class="keyword">string</span>,<span class="number">10</span>)</span><br><span class="line">	<span class="comment">//此时将向切片中追加第11个元素</span></span><br><span class="line">	test_cut2 = <span class="built_in">append</span>(test_cut2,<span class="string">&quot;hhhhhhhhh&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h2><p>映射（map）：可将键映射到值<br>与数组和切片使用序列整数作为索引不同的是，映射的键几乎可以是任何类型</p>
<p>可以理解为Python中的字典</p>
<p>Go语言必须为映射的键和值指定类型<br>格式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">map</span>[键的类型]值的类型</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//声明map方法一：</span></span><br><span class="line">	map1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">		<span class="string">&quot;key1&quot;</span>:<span class="number">1</span>,</span><br><span class="line">		<span class="string">&quot;key2&quot;</span>:<span class="number">2</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//声明map方法二</span></span><br><span class="line">	map2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line">	map2[<span class="string">&quot;New_York&quot;</span>] = <span class="number">1</span></span><br><span class="line">	map2[<span class="string">&quot;San_Franscisco&quot;</span>] = <span class="number">2</span></span><br><span class="line">	map2[<span class="string">&quot;Tokyo&quot;</span>] = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//数组或一些基本类型在赋值给新变量或传递至函数/方法时都会创建相应的副本，但映射不会</span></span><br><span class="line">	map3 := map1</span><br><span class="line">	map3[<span class="string">&quot;key1&quot;</span>]=<span class="number">2</span></span><br><span class="line">	fmt.Println(map3)</span><br><span class="line">	fmt.Println(map1)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//遍历映射</span></span><br><span class="line">	<span class="comment">//遍历键</span></span><br><span class="line">	<span class="keyword">for</span> key := <span class="keyword">range</span> map2&#123;</span><br><span class="line">		fmt.Print(key)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Print(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//遍历值</span></span><br><span class="line">	<span class="keyword">for</span> _,value := <span class="keyword">range</span> map2&#123;</span><br><span class="line">		fmt.Print(value)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Print(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//遍历键值</span></span><br><span class="line">	<span class="keyword">for</span> key,value := <span class="keyword">range</span> map2&#123;</span><br><span class="line">		fmt.Println(key,value)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//删除键值对</span></span><br><span class="line">	<span class="comment">//delete(map_name,key_name)</span></span><br><span class="line">	<span class="built_in">delete</span>(map2,<span class="string">&quot;New_York&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断某一个键值对是否存在</span></span><br><span class="line">	<span class="comment">//当键值对不存在，输出对应数据类型的零值</span></span><br><span class="line">	fmt.Println(map2[<span class="string">&quot;New_York&quot;</span>])</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用value, ok := map[key]的写法判断</span></span><br><span class="line">	map2[<span class="string">&quot;Shenzheng&quot;</span>] = <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> value,ok := map2[<span class="string">&quot;Shenzheng&quot;</span>]; ok&#123;</span><br><span class="line">		fmt.Println(value,<span class="string">&quot; is exited.&quot;</span>)</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;not exited&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="状态与行为"><a href="#状态与行为" class="headerlink" title="状态与行为"></a>状态与行为</h1><p>状态：可以是值或结构package main<br>行为：函数和方法</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>基本用法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义结构</span></span><br><span class="line"><span class="keyword">type</span> city <span class="keyword">struct</span>&#123;</span><br><span class="line">	country,name <span class="keyword">string</span></span><br><span class="line">	rank <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义结构</span></span><br><span class="line"><span class="keyword">type</span> city <span class="keyword">struct</span>&#123;</span><br><span class="line">	country,name <span class="keyword">string</span></span><br><span class="line">	rank <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//声明方法一：</span></span><br><span class="line">	<span class="keyword">var</span> newYork city</span><br><span class="line">	newYork.rank = <span class="number">1</span></span><br><span class="line">	newYork.name = <span class="string">&quot;New York&quot;</span></span><br><span class="line">	newYork.country = <span class="string">&quot;American&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//声明方法二：</span></span><br><span class="line">	<span class="keyword">var</span> tokyo = city&#123;country:<span class="string">&quot;Japan&quot;</span>,rank:<span class="number">2</span>&#125;</span><br><span class="line">	<span class="comment">//未给定字段则自动声明为对应的零值</span></span><br><span class="line">	fmt.Println(tokyo.name)</span><br><span class="line">	tokyo.name = <span class="string">&quot;Tokyo&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//结构复制</span></span><br><span class="line">	<span class="comment">//两个结构变化不会对彼此有任何影响</span></span><br><span class="line">	anotherTokyo := tokyo</span><br><span class="line">	anotherTokyo.rank = <span class="number">3</span></span><br><span class="line">	fmt.Println(anotherTokyo,<span class="string">&quot;\n&quot;</span>,tokyo)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//由结构组成的切片</span></span><br><span class="line">	cities := []city&#123;newYork,tokyo&#125;</span><br><span class="line">	fmt.Println(cities)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//临时使用的匿名结构</span></span><br><span class="line">	hhhh := <span class="keyword">struct</span> &#123;</span><br><span class="line">		ccc <span class="keyword">int</span></span><br><span class="line">		ddd <span class="keyword">string</span></span><br><span class="line">	&#125;&#123;<span class="number">2333333</span>,<span class="string">&quot;2333333333&quot;</span>&#125;</span><br><span class="line">	fmt.Println(hhhh)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Go面向对象"><a href="#Go面向对象" class="headerlink" title="Go面向对象"></a>Go面向对象</h2><p>Go没有类，而是通过结构与方法的结合实现面向对象</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> literallyPopulation <span class="keyword">struct</span> &#123;</span><br><span class="line">	literalRate <span class="keyword">float64</span></span><br><span class="line">	totalPopulation <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> country <span class="keyword">struct</span> &#123;</span><br><span class="line">	countryName <span class="keyword">string</span></span><br><span class="line">	<span class="comment">//运用组合</span></span><br><span class="line">	theLiterallyPopulation literallyPopulation</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newCountry</span><span class="params">(countryName <span class="keyword">string</span>, literalRate <span class="keyword">float64</span>,totalPopulation <span class="keyword">int</span>)</span> <span class="params">(c country)</span></span>&#123;</span><br><span class="line">	l := literallyPopulation&#123;literalRate:literalRate,totalPopulation:totalPopulation&#125;</span><br><span class="line">	c = country&#123;countryName:countryName,theLiterallyPopulation: l&#125;</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(theLiteralPopulation literallyPopulation)</span> <span class="title">countLiteralPopulation</span><span class="params">()</span> <span class="params">(<span class="keyword">float64</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> theLiteralPopulation.literalRate*<span class="keyword">float64</span>(theLiteralPopulation.totalPopulation)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//转发</span></span><br><span class="line"><span class="comment">//手动转发</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c country)</span> <span class="title">countLiteralPopulation</span><span class="params">()</span> <span class="title">float64</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> c.theLiterallyPopulation.literalRate*<span class="keyword">float64</span>(c.theLiterallyPopulation.totalPopulation)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">c := newCountry(<span class="string">&quot;hhhh&quot;</span>,<span class="number">0.34</span>,<span class="number">10000</span>)</span><br><span class="line">lp := c.countLiteralPopulation()</span><br><span class="line">fmt.Println(lp)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现自动转发：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//我代码呢？</span></span><br></pre></td></tr></table></figure>

<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>用于实现多态</p>
<p>接口是一种类型，是一组method的集合<br>接口命名一般以-er结尾</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> shower <span class="keyword">interface</span> &#123;</span><br><span class="line">	showName() <span class="keyword">string</span></span><br><span class="line">	showRank() <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> sayer <span class="keyword">interface</span> &#123;</span><br><span class="line">	sayCharacteristic() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接口嵌套</span></span><br><span class="line"><span class="keyword">type</span> sayAndShower <span class="keyword">interface</span> &#123;</span><br><span class="line">	sayer</span><br><span class="line">	shower</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> city <span class="keyword">struct</span> &#123;</span><br><span class="line">	name           <span class="keyword">string</span></span><br><span class="line">	rank           <span class="keyword">int</span></span><br><span class="line">	characteristic <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> country <span class="keyword">struct</span> &#123;</span><br><span class="line">	name           <span class="keyword">string</span></span><br><span class="line">	rank           <span class="keyword">int</span></span><br><span class="line">	characteristic <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(city city)</span> <span class="title">showName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> city.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(city city)</span> <span class="title">showRank</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> city.rank</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(city city)</span> <span class="title">sayCharacteristic</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> city.characteristic</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(country country)</span> <span class="title">showName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> country.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(country country)</span> <span class="title">showRank</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> country.rank</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(country country)</span> <span class="title">sayCharacteristic</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> country.characteristic</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	structCity := city&#123;characteristic: <span class="string">&quot;very big&quot;</span>, rank: <span class="number">23333</span>, name: <span class="string">&quot;city of night&quot;</span>&#125;</span><br><span class="line">	structCountry := country&#123;characteristic: <span class="string">&quot;nb&quot;</span>, rank: <span class="number">100</span>, name: <span class="string">&quot;nbcountry&quot;</span>&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//指针类型</span></span><br><span class="line">	<span class="keyword">var</span> show shower</span><br><span class="line">	<span class="comment">//var say sayer</span></span><br><span class="line"></span><br><span class="line">	show = structCity</span><br><span class="line">	fmt.Println(show.showRank())</span><br><span class="line">	fmt.Println(show.showName())</span><br><span class="line"></span><br><span class="line">	show = structCountry</span><br><span class="line">	fmt.Println(show.showRank())</span><br><span class="line">	fmt.Println(show.showName())</span><br><span class="line"></span><br><span class="line">    say := structCity</span><br><span class="line">	fmt.Println(say.sayCharacteristic())</span><br><span class="line"></span><br><span class="line">	say = structCountry</span><br><span class="line">	fmt.Println(say.sayCharacteristic())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> showAndSay sayAndShower</span><br><span class="line">	showAndSay = structCountry</span><br><span class="line">	fmt.Println(showAndSay.showRank(), showAndSay.showName(), showAndSay.sayCharacteristic())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h1><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>几点需要注意的：</p>
<ul>
<li>对于指向结构的指针，Go中用.即可完成对方法和字段的访问，且解引用不是必须的</li>
<li>Go中数组与指针是两种独立的类型</li>
<li>对于指向数组的指针，Go语言提供了自动解引用的特性，即解引用不是必须的</li>
<li>Go语言没有为切片和映射提供了自动解引用的特性</li>
<li>映射是一种隐式指针，所以是指针指向映射的举动往往是多此一举</li>
<li>切片实际上是指向数组的指针</li>
<li>指向切片的指针的作用是修改切片本身，包括切片的长度，容量和起始偏移量</li>
<li>方法的接收者和函数形参在处理指针方面十分类似，都可以实现对原有字段的改变</li>
<li>关于指针和接口：指针接收者能仅能接收指针变量，而值接收者可接受指针或非指针变量</li>
</ul>
<h2 id="nil"><a href="#nil" class="headerlink" title="nil"></a>nil</h2><p>nil是指针，切片，映射和接口的零值<br>解引用nil指针将引发恐慌（panic）</p>
<ul>
<li>nil与方法：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">	score <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *person)</span> <span class="title">getScore</span><span class="params">()</span></span> &#123;</span><br><span class="line">	p.score++ <span class="comment">//此处发生了解引用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> p *person</span><br><span class="line">	p.getScore() <span class="comment">//解引用nil指针，引发恐慌</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>nil与函数：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn <span class="function"><span class="keyword">func</span><span class="params">(a,b <span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br><span class="line">fn(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">//解引用nil指针引发惊恐</span></span><br></pre></td></tr></table></figure>
<ul>
<li>nil与切片：<br>不包含任何元素的空切片和nil切片并不相等，但通常可以替换使用</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> slice []<span class="keyword">int</span> <span class="comment">//值为nil的切片</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//关键字range，len()和append()等可以正常处理nil切片</span></span><br><span class="line">	<span class="keyword">for</span> _, ingredient := <span class="keyword">range</span> slice &#123;</span><br><span class="line">		fmt.Println(ingredient) <span class="comment">//不会包含任何输出</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(slice))</span><br><span class="line"></span><br><span class="line">	slice = <span class="built_in">append</span>(slice, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">	<span class="comment">//关键字range，len()和append()等可以正常处理nil切片</span></span><br><span class="line">	<span class="keyword">for</span> _, ingredient := <span class="keyword">range</span> slice &#123;</span><br><span class="line">		fmt.Println(ingredient) <span class="comment">//不会包含任何输出</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(slice))</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//不包含任何元素的空切片和nil切片替换使用</span></span><br><span class="line">	slice = <span class="built_in">append</span>(slice, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nil与映射<br>映射在声明之后若没有使用复合字面量或内置make函数初始化，则其值为默认的nil。<br>可以对值为nil的map进行读取操作，但不可进行写入操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> map1 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//进行读取操作</span></span><br><span class="line">	value, ok := map1[<span class="string">&quot;hhhh&quot;</span>]</span><br><span class="line">	<span class="keyword">if</span> ok &#123;</span><br><span class="line">		fmt.Println(value)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> key, value := <span class="keyword">range</span> map1 &#123;</span><br><span class="line">		fmt.Println(key, value)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nil与接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//空接口妙用之一:以空接口作为函数行参，可以向函数传递任何类型的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span>&#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Type:%T Value:%v \n&quot;</span>,x,x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//空接口可以储存任意类型的值</span></span><br><span class="line">	<span class="comment">//定义一个空接口的值</span></span><br><span class="line">	<span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	i:= <span class="number">100</span></span><br><span class="line">	j:= <span class="string">&quot;hhhhhh&quot;</span></span><br><span class="line">	k:= <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	x = i</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Type:%T Value:%v \n&quot;</span>,x,x)</span><br><span class="line"></span><br><span class="line">	x=j</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Type:%T Value:%v \n&quot;</span>,x,x)</span><br><span class="line"></span><br><span class="line">	x=k</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Type:%T Value:%v \n&quot;</span>,x,x)</span><br><span class="line"></span><br><span class="line">	show(i)</span><br><span class="line">	show(j)</span><br><span class="line">	show(k)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//空接口妙用之二：使用空接口实现保存任何值的特点</span></span><br><span class="line">	<span class="keyword">var</span> stuInfo = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	</span><br><span class="line">	stuInfo[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;bai&quot;</span></span><br><span class="line">	stuInfo[<span class="string">&quot;age&quot;</span>] = <span class="number">12</span></span><br><span class="line">	stuInfo[<span class="string">&quot;sex&quot;</span>] = <span class="string">&quot;nan&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h1><h2 id="扫一下盲"><a href="#扫一下盲" class="headerlink" title="扫一下盲"></a>扫一下盲</h2><p>Go中，独立运行的任务谓之goroutine<br>goroutine之间的通信依赖通道<br>通道(channel)是一种类型</p>
<blockquote>
<p> A.进程是程序在操作系统中的一次执行过程，系统进行资源分配和调度的一个独立单位。<br> B. 线程是进程的一个执行实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位。<br> C.一个进程可以创建和撤销多个线程;同一个进程中的多个线程之间可以并发执行。</p>
</blockquote>
<p>并发：多线程程序在一个核的cpu上运行<br>并行：多线程程序在多个核的cpu上运行</p>
<p>协程：比线程更轻量级的存在，一个线程可拥有多个协程。协程不是被操作系统内核所管理的，而是完全由程序所控制，也就是在用户态执行。这样带来的好处是性能大幅度的提升，因为不会像线程切换那样消耗资源。（线程是由操作系统内核管理的）</p>
<p>协程可以理解为一个特殊的函数</p>
<p>一个线程的多个协程的运行是串行的。当一个协程运行时，其它协程必须挂起。</p>
<blockquote>
<p>上下文切换</p>
<ul>
<li>进程的切换者是操作系统，切换时机是根据操作系统自己的切换策略，用户是无感知的。进程的切换内容包括页全局目录、内核栈、硬件上下文，切换内容保存在内存中。进程切换过程是由“用户态到内核态到用户态”的方式，切换效率低。</li>
<li>线程的切换者是操作系统，切换时机是根据操作系统自己的切换策略，用户无感知。线程的切换内容包括内核栈和硬件上下文。线程切换内容保存在内核栈中。线程切换过程是由“用户态到内核态到用户态”， 切换效率中等。</li>
<li>协程的切换者是用户（编程者或应用程序），切换时机是用户自己的程序所决定的。协程的切换内容是硬件上下文，切换内存保存在用户自己的变量（用户栈或堆）中。协程的切换过程只有用户态，即没有陷入内核态，因此切换效率高。</li>
</ul>
</blockquote>
<p>python两种并发：1，多线程和多进程来进行并发；2，使用协程进程并发</p>
<p>python大部分库基于前一种并发方式，而go则完全基于后一种来开发</p>
<h2 id="sync-WaitGroup"><a href="#sync-WaitGroup" class="headerlink" title="sync.WaitGroup"></a>sync.WaitGroup</h2><table>
<thead>
<tr>
<th>方法名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>(wg * WaitGroup) Add(delta int)</td>
<td>计数器+delta</td>
</tr>
<tr>
<td>(wg *WaitGroup) Done()</td>
<td>计数器-1</td>
</tr>
<tr>
<td>(wg *WaitGroup) Wait()</td>
<td>阻塞直到计数器变为0</td>
</tr>
</tbody></table>
<p>例如当我们启动了N 个并发任务时，就将计数器值增加N。每个任务完成时通过调用Done()方法将计数器减1。通过调用Wait()来等待并发任务执行完，当计数器值为0时，表示所有并发任务已经完成。</p>
<h2 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sleepyGopher</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	fmt.Println(i, <span class="string">&quot;awake&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="comment">//使用go关键字启动一个线程</span></span><br><span class="line">		<span class="keyword">go</span> sleepyGopher(i)</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//因为main函数本身也是一个协程，而主协程一旦结束，则其它的协程也会结束</span></span><br><span class="line">    <span class="comment">//所以需要sync.WaitGroup来实现并发任务的同步</span></span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用互斥锁同步协程"><a href="#使用互斥锁同步协程" class="headerlink" title="使用互斥锁同步协程"></a>使用互斥锁同步协程</h2><ul>
<li>并发要面临资源竞争问题</li>
</ul>
<p>最后得到的结果与预期不相符</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">        x = x + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">go</span> add()</span><br><span class="line">    <span class="keyword">go</span> add()</span><br><span class="line">    wg.Wait()</span><br><span class="line">    fmt.Println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此时引入互斥锁解决数据同步的问题</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">		lock.Lock()</span><br><span class="line">		x = x + <span class="number">1</span></span><br><span class="line">		lock.Unlock()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sub</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">		<span class="comment">//互相竞争资源的步骤必须使用同一把锁</span></span><br><span class="line">		lock.Lock()</span><br><span class="line">		x = x - <span class="number">1</span></span><br><span class="line">		lock.Unlock()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">go</span> add()</span><br><span class="line">	<span class="keyword">go</span> sub()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>能不用锁就不用锁，因为开锁解锁消耗时间，影响性能</p>
<h2 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h2><p>对于绝大多数web系统，读多写少</p>
<p>我们必须要在读和写上加锁，但当读的操作很多时，一个读的操作上锁对其它读的操作影响不容小觑。</p>
<p>例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">	fmt.Println(<span class="string">&quot;读&quot;</span>)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;读毕&quot;</span>)</span><br><span class="line">	lock.UnLock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span> ; i++&#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> read()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，我们需要一把读之间不会相互竞争，而读写之间会相互竞争的锁。</p>
<p>引入读写锁。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.RWMutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.RLock()</span><br><span class="line">	fmt.Println(<span class="string">&quot;读&quot;</span>)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;读毕&quot;</span>)</span><br><span class="line">	lock.RUnlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">	fmt.Println(<span class="string">&quot;写&quot;</span>)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">10</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;写毕&quot;</span>)</span><br><span class="line">	lock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> read()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> write()</span><br><span class="line"></span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="协程间的通信机制"><a href="#协程间的通信机制" class="headerlink" title="协程间的通信机制"></a>协程间的通信机制</h2><p>channel提供了一种定向通信机制(python和java常用消息队列实现)</p>
<p>分类：有无缓冲；双向还是单向</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(data <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">	<span class="comment">//第一种取法</span></span><br><span class="line">	<span class="comment">/*	msg,ok := &lt;- data</span></span><br><span class="line"><span class="comment">		if(ok)&#123;</span></span><br><span class="line"><span class="comment">			fmt.Println(msg)</span></span><br><span class="line"><span class="comment">		&#125;*/</span></span><br><span class="line">	<span class="comment">//使用 for range 来取：</span></span><br><span class="line">	<span class="keyword">for</span> msg := <span class="keyword">range</span> data &#123;</span><br><span class="line">		fmt.Println(msg)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	lock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//定义时必须指定类型</span></span><br><span class="line">	<span class="comment">//channel为引用类型，默认为nil</span></span><br><span class="line">	<span class="keyword">var</span> msg <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">	<span class="comment">//使用make初始化的有三种：chan map slice</span></span><br><span class="line">	<span class="comment">//若缓冲空间满了还往其中放值会引发错误</span></span><br><span class="line">	<span class="comment">//msg = make(chan int)    //这种存储方式无缓冲</span></span><br><span class="line">	msg = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>) <span class="comment">//第二种存储方式：有缓冲；第二个参数指定缓冲空间</span></span><br><span class="line">	msg &lt;- <span class="number">1</span></span><br><span class="line">	<span class="comment">//利用一个协程来腾空缓冲空间</span></span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> consumer(msg)</span><br><span class="line">	msg &lt;- <span class="number">2</span></span><br><span class="line">	<span class="comment">//fmt.Println(data)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//关闭通道 1,关闭的channel不能再向其中发送数据 2，消费者可继续消费数据，直到数据被消费完</span></span><br><span class="line">	<span class="built_in">close</span>(msg)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>无缓冲通道的使用</li>
</ul>
<p>对于一个无缓冲的channel，在启动一个消费者之前放数据就会报错</p>
<p>在放一个数据到channel中时，会阻塞数据，阻塞之前会放一把锁；只有当取值时，这把锁才会解开</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(data <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">    <span class="comment">//当通道未关闭时，ok返回true，否则，返回false</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		msg, ok := &lt;-data</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(msg)</span><br><span class="line">	&#125;</span><br><span class="line">	lock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> msg <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	msg = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用无缓冲通道时，在向管道发送信息之前，另一端必须要有消费者</span></span><br><span class="line">	<span class="keyword">go</span> consumer(msg)</span><br><span class="line">	msg &lt;- <span class="number">1</span></span><br><span class="line">	msg &lt;- <span class="number">3</span></span><br><span class="line">	<span class="built_in">close</span>(msg)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="双向和单向的channel"><a href="#双向和单向的channel" class="headerlink" title="双向和单向的channel"></a>双向和单向的channel</h2><p>能使用单向channel就尽量使用单向channel</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="comment">//只能从中取值，不能从中放值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(data &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		msg, ok := &lt;-data</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(msg)</span><br><span class="line">	&#125;</span><br><span class="line">	lock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个只能往其中放值，不能从中取值的channel</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(data <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		data &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> msg <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	msg = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用无缓冲通道时，在向管道发送信息之前，另一端必须要有消费者</span></span><br><span class="line">	<span class="comment">//普通的channel可直接转换为单向的channel，反之则不行</span></span><br><span class="line">	<span class="keyword">go</span> consumer(msg)</span><br><span class="line">	<span class="keyword">go</span> producer(msg)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">close</span>(msg)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><p>select作用域通讯场景，伪随机选择一组可能的send和receive操作去执行。</p>
<p>考虑有多个case等待处理的情况，比如同时有多个channnel可以接收数据，那么select会伪随机选择一个case去处理；若无case需要处理，那么select会选择default取处理；如果没有default，那么select会阻塞，直到某个case需要处理。</p>
<p>select应用场景：</p>
<ul>
<li>timeout超时机制</li>
<li>判断channel是否被阻塞</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//timeout超时机制</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> msg <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	msg = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">		msg &lt;- <span class="number">1</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> res := &lt;-msg:</span><br><span class="line">		fmt.Println(res)</span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(time.Second):</span><br><span class="line">		fmt.Println(<span class="string">&quot;timeout 1&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(msg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断channel是否被阻塞</span></span><br><span class="line"><span class="comment">//若所有的channel都被阻塞了，那么就会执行default</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	msg1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line">	msg2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">		msg1 &lt;- <span class="number">1</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">		msg2 &lt;- <span class="number">1</span></span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> res := &lt;-msg1:</span><br><span class="line">		fmt.Println(res)</span><br><span class="line">	<span class="keyword">case</span> res := &lt;-msg2:</span><br><span class="line">		fmt.Println(res)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(msg1)</span><br><span class="line">	<span class="built_in">close</span>(msg2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>场景：</p>
<p>假设在有一个goroutine，希望它在一定时间内监控cpu信息，之后退出</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stop <span class="keyword">chan</span> <span class="keyword">bool</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cpuInfo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-stop:</span><br><span class="line">			fmt.Println(<span class="string">&quot;monitor closes&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">			fmt.Println(<span class="string">&quot;monitor is running&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> cpuInfo()</span><br><span class="line">	time.Sleep(<span class="number">6</span> * time.Second)</span><br><span class="line">	stop &lt;- <span class="literal">true</span></span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(<span class="string">&quot;goroutine finishes&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="context"><a href="#context" class="headerlink" title="context"></a>context</h2><p>考虑更复杂的场景，若有多个监控协程在运行，还想用上面的select加channel的方式来指定时间退出的操作，我们就需要向管道中传多个值。</p>
<p>这时引入context：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cpuInfo</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="comment">//检验context是否cancel</span></span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">			fmt.Println(<span class="string">&quot;cpu monitor finishes&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">			fmt.Println(<span class="string">&quot;cpu monitor is running&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">memoryInfo</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="comment">//若父context cancel，则子context也会cancel</span></span><br><span class="line">	ctx2, _ := context.WithCancel(ctx)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx2.Done():</span><br><span class="line">			fmt.Println(<span class="string">&quot;memory monitor finishes&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">			fmt.Println(<span class="string">&quot;memory monitor is running&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indicatorInfo</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">			fmt.Println(<span class="string">&quot;indicator monitor finishes&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">			fmt.Println(<span class="string">&quot;indicator monitor is running&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line"></span><br><span class="line">	wg.Add(<span class="number">3</span>)</span><br><span class="line">	<span class="keyword">go</span> cpuInfo(ctx)</span><br><span class="line">	<span class="keyword">go</span> memoryInfo(ctx)</span><br><span class="line">	<span class="keyword">go</span> indicatorInfo(ctx)</span><br><span class="line">	time.Sleep(<span class="number">6</span> * time.Second)</span><br><span class="line">	cancel()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(<span class="string">&quot;all monitors finish&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>几种context：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">context.WithCancel() <span class="comment">//可取消，手动cancel</span></span><br><span class="line">context.WithDeadline() <span class="comment">//可取消，在某一个时间点之前取消，也可手动取消</span></span><br><span class="line">context.WithTimeout() <span class="comment">//可取消，设置超时间，也可在timeout之前手动取消</span></span><br></pre></td></tr></table></figure>

<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><h2 id="随便说说"><a href="#随便说说" class="headerlink" title="随便说说"></a>随便说说</h2><ul>
<li>go异常处理思想：<br>若一个函数可能出现异常，那么就应把异常作为返回值，没有异常就返回nil</li>
</ul>
<p>关于defer</p>
<ul>
<li><p>defer之后只能是函数调用，不能是表达式</p>
</li>
<li><p>若有多个defer，则会创建一个defer栈，后注册的defer先执行</p>
</li>
<li><p>向defer中传递的函数是值，不是引用；压入的不仅是函数，还有参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出hhhh</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;hhhh&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f()</span><br><span class="line">	f = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;23333&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出1</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">1</span></span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">(a <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">		fmt.Println(a)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f(x)</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出2</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">1</span></span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">(a *<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">		fmt.Println(a)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f(&amp;x)</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出2，这是由于闭包的特性</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">1</span></span><br><span class="line">    <span class="comment">//使用的是全局的值，上面几个例子优先使用局部变量</span></span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(x)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f()</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出1，优先使用局部变量</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">1</span></span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">		fmt.Println(x)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f(x)</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="panic和recover"><a href="#panic和recover" class="headerlink" title="panic和recover"></a>panic和recover</h2><p>错误和异常概念区分：</p>
<ul>
<li><p>错误：错误你可以预判</p>
</li>
<li><p>异常：不可预判，往往是由于代码不严谨</p>
</li>
</ul>
<p>错误：</p>
<p>错误的场景：</p>
<ul>
<li>文件IO</li>
<li>数据库连接</li>
<li>空指针引用</li>
<li>下标越界</li>
<li>锁</li>
<li>…</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对于可能出现错误的地方要提取预知</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;hhhhh&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="number">1</span></span><br><span class="line">	b := <span class="number">0</span></span><br><span class="line">	r, err := f(a, b)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抛出异常和捕捉异常：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对于可能出现错误的地方要提取预知</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> b == <span class="number">0</span>&#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;hhhhh&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> a / b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="number">1</span></span><br><span class="line">	b := <span class="number">0</span></span><br><span class="line">	<span class="comment">//recover必须执行</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		err := <span class="built_in">recover</span>()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="comment">//这样无效</span></span><br><span class="line">	<span class="comment">//defer recover()</span></span><br><span class="line">	fmt.Println(f(a, b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在任一子协程中使用panic抛出错误会导致主协程挂掉，同时导致其它的协程挂掉</p>
</li>
<li><p>在一个协程中再开一个协程，父协程捕获不到子协程抛出的异常，所以会出现上述问题</p>
</li>
<li><p>一种处理方法：单独写一个函数用于捕获异常，每开一个协程就defer这个函数</p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/go/" rel="tag"># go</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/09/25/python-mongodb/" rel="prev" title="python-mongodb">
      <i class="fa fa-chevron-left"></i> python-mongodb
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/10/01/python%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="next" title="python多线程">
      python多线程 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%83%8A%E9%B8%BF%E4%B8%80%E7%9E%A5"><span class="nav-number">1.</span> <span class="nav-text">惊鸿一瞥</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hello%EF%BC%8CWorld"><span class="nav-number">1.1.</span> <span class="nav-text">Hello，World</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86"><span class="nav-number">1.2.</span> <span class="nav-text">基本知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84"><span class="nav-number">1.3.</span> <span class="nav-text">基本控制结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">1.4.</span> <span class="nav-text">作用域</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.</span> <span class="nav-text">类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%AE%E7%82%B9%E6%95%B0"><span class="nav-number">2.1.</span> <span class="nav-text">浮点数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E6%95%B0"><span class="nav-number">2.2.</span> <span class="nav-text">整数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#big%E5%8C%85"><span class="nav-number">2.3.</span> <span class="nav-text">big包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E8%AF%AD%E8%A8%80%E6%96%87%E6%9C%AC"><span class="nav-number">2.4.</span> <span class="nav-text">多语言文本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">2.5.</span> <span class="nav-text">类型转换</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E5%9D%97"><span class="nav-number">3.</span> <span class="nav-text">构建块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95"><span class="nav-number">3.2.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E7%AD%89%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.</span> <span class="nav-text">一等函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AD%E5%8C%85%E5%92%8C%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0"><span class="nav-number">3.4.</span> <span class="nav-text">闭包和匿名函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0"><span class="nav-number">3.5.</span> <span class="nav-text">可变参数函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%94%B6%E9%9B%86%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">收集器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E7%BB%84"><span class="nav-number">4.1.</span> <span class="nav-text">数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%87%E7%89%87"><span class="nav-number">4.2.</span> <span class="nav-text">切片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%A0%E5%B0%84"><span class="nav-number">4.3.</span> <span class="nav-text">映射</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E4%B8%8E%E8%A1%8C%E4%B8%BA"><span class="nav-number">5.</span> <span class="nav-text">状态与行为</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84"><span class="nav-number">5.1.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Go%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="nav-number">5.2.</span> <span class="nav-text">Go面向对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3"><span class="nav-number">5.3.</span> <span class="nav-text">接口</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%87%E9%92%88"><span class="nav-number">6.</span> <span class="nav-text">指针</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">6.1.</span> <span class="nav-text">基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nil"><span class="nav-number">6.2.</span> <span class="nav-text">nil</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91"><span class="nav-number">7.</span> <span class="nav-text">并发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%AB%E4%B8%80%E4%B8%8B%E7%9B%B2"><span class="nav-number">7.1.</span> <span class="nav-text">扫一下盲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sync-WaitGroup"><span class="nav-number">7.2.</span> <span class="nav-text">sync.WaitGroup</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#goroutine"><span class="nav-number">7.3.</span> <span class="nav-text">goroutine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BA%92%E6%96%A5%E9%94%81%E5%90%8C%E6%AD%A5%E5%8D%8F%E7%A8%8B"><span class="nav-number">7.4.</span> <span class="nav-text">使用互斥锁同步协程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E9%94%81"><span class="nav-number">7.5.</span> <span class="nav-text">读写锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6"><span class="nav-number">7.6.</span> <span class="nav-text">协程间的通信机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8C%E5%90%91%E5%92%8C%E5%8D%95%E5%90%91%E7%9A%84channel"><span class="nav-number">7.7.</span> <span class="nav-text">双向和单向的channel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#select"><span class="nav-number">7.8.</span> <span class="nav-text">select</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#context"><span class="nav-number">7.9.</span> <span class="nav-text">context</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">8.</span> <span class="nav-text">异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%8F%E4%BE%BF%E8%AF%B4%E8%AF%B4"><span class="nav-number">8.1.</span> <span class="nav-text">随便说说</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#panic%E5%92%8Crecover"><span class="nav-number">8.2.</span> <span class="nav-text">panic和recover</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">GuiYoung</p>
  <div class="site-description" itemprop="description">十有九人堪白眼，百无一用是书生</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GuiYoung</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
