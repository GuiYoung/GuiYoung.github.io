<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="十有九人堪白眼，百无一用是书生">
<meta property="og:type" content="website">
<meta property="og:title" content="Las Nubes">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Las Nubes">
<meta property="og:description" content="十有九人堪白眼，百无一用是书生">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="GuiYoung">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Las Nubes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Las Nubes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/06/javaOOP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/06/javaOOP/" class="post-title-link" itemprop="url">javaOOP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-10-06 08:35:17 / Modified: 09:30:44" itemprop="dateCreated datePublished" datetime="2021-10-06T08:35:17+08:00">2021-10-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="按值传送"><a href="#按值传送" class="headerlink" title="按值传送"></a>按值传送</h1><p>在java中，若将对象实例作为变量传送给方法时，自变量的值是对对象的引用。</p>
<h1 id="重载方法名"><a href="#重载方法名" class="headerlink" title="重载方法名"></a>重载方法名</h1><p>java依靠参数列表来区分不同的重载的方法</p>
<h1 id="java构造方法"><a href="#java构造方法" class="headerlink" title="java构造方法"></a>java构造方法</h1><p>java的默认构造方法会为各个域的值赋空（null）或赋0。</p>
<p>java构造方法重载时常常借助this关键字</p>
<h1 id="finalize-方法"><a href="#finalize-方法" class="headerlink" title="finalize()方法"></a>finalize()方法</h1><p>相当于C++中的析构方法，用于释放对象所占用的系统资源。</p>
<h1 id="this引用"><a href="#this引用" class="headerlink" title="this引用"></a>this引用</h1><p>在java中，常常不需要像python那样，总是用类似self.的this.来指明类中的对象.</p>
<h1 id="java继承与extends关键字"><a href="#java继承与extends关键字" class="headerlink" title="java继承与extends关键字"></a>java继承与extends关键字</h1><p>格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">B</span></span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>表面A派生于B</p>
<p>子类拥有父类所有变量和方法</p>
<h1 id="单重继承"><a href="#单重继承" class="headerlink" title="单重继承"></a>单重继承</h1><p>若一个类有父类，则其父类只能有一个</p>
<p>子类不能从父类继承构造方法</p>
<p>只有两种方法能让一个类得到一个构造方法：一，自己编写一个；二，不编写，系统默认给予</p>
<p>子类不能访问父类的私有元素</p>
<h1 id="转换对象"><a href="#转换对象" class="headerlink" title="转换对象"></a>转换对象</h1><p>假设Employee是Manager和Contractor的父类</p>
<p>那么：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 合法</span><br><span class="line">// 此时e可访问Employee的变量和方法，却不能访问Manager独有的</span><br><span class="line">Employee e = new Manager();</span><br><span class="line"></span><br><span class="line">// 不合法</span><br><span class="line">Manager m = new Employee();</span><br></pre></td></tr></table></figure>

<p>Employee类型的引用指向一个对象，但分不清该对象是Employee类还是Manager类还是Contractor类，则：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">(Employee e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> Manager) &#123;</span><br><span class="line">        <span class="comment">// 此时e只能访问Employee的变量和方法，若想要访问Manager的，需要转换引用</span></span><br><span class="line">        Mnager m = (Manager)e; <span class="comment">// m能够访问Manager的变量和方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> Contractor)&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转换引用的类之间必须要有继承关系</p>
<h1 id="异类集合"><a href="#异类集合" class="headerlink" title="异类集合"></a>异类集合</h1><p>可以创建有公共祖先的任何元素的集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Employee [] staff = <span class="keyword">new</span> Employee[<span class="number">1024</span>];</span><br><span class="line">staff[<span class="number">0</span>] = <span class="keyword">new</span> Manager();</span><br><span class="line">staff[<span class="number">1</span>] = <span class="keyword">new</span> Employee();</span><br></pre></td></tr></table></figure>

<h1 id="super关键字"><a href="#super关键字" class="headerlink" title="super关键字"></a>super关键字</h1><p>若子类已重写父类的方法，但子类还想访问，则可用super关键字</p>
<p>super.method()访问的不一定是父类自由的，也可能是父类从祖先继承来的</p>
<h1 id="重写规则"><a href="#重写规则" class="headerlink" title="重写规则"></a>重写规则</h1><ul>
<li>重写方法允许访问的权限不能比原方法小</li>
<li>抛出的异常不能比原方法多</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这样写是错的</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperClass</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SonClass</span> <span class="keyword">extends</span> <span class="title">SuperClass</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="父类构造方法的调用"><a href="#父类构造方法的调用" class="headerlink" title="父类构造方法的调用"></a>父类构造方法的调用</h1><p>Java要求父类的对象要在子类运行前完全初始化</p>
<p>借助super()初始化</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/05/protobuf%E8%BF%9B%E9%98%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/05/protobuf%E8%BF%9B%E9%98%B6/" class="post-title-link" itemprop="url">protobuf进阶</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-10-05 21:37:02 / Modified: 21:59:29" itemprop="dateCreated datePublished" datetime="2021-10-05T21:37:02+08:00">2021-10-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="protobuf基本语法"><a href="#protobuf基本语法" class="headerlink" title="protobuf基本语法"></a>protobuf基本语法</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4443c28d4bf7"></a></p>
<h1 id="python沟通protobuf时会遇到的问题"><a href="#python沟通protobuf时会遇到的问题" class="headerlink" title="python沟通protobuf时会遇到的问题"></a>python沟通protobuf时会遇到的问题</h1><p>若想传一个列表类型，在poroto文件中应使用repeated关键字</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloRequest</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">repeated</span> <span class="built_in">int32</span> id = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时在python代码中不能对其直接实例化后直接赋值，而是应使用列表的方法（如：extend，append）等去改变它的值</p>
<p>此外，嵌套定义message也不能实例化后直接赋值</p>
<h1 id="go-package详解"><a href="#go-package详解" class="headerlink" title="go_package详解"></a>go_package详解</h1><p>设置：</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">option</span> go_package = <span class="string">&quot;common/stream/proto/v1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>执行：</p>
<p>cd 到目标文件夹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --go_out=plugins=grpc:./ ./hello.proto</span><br></pre></td></tr></table></figure>

<p>即使目标文件夹下不存在common/stream/proto/v1也会生成common/stream/proto/v1/hello.pb.go脚本</p>
<p>或者：</p>
<p>设置：</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">option</span> go_package = <span class="string">&quot;../common/stream/proto/v1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>执行命令后会在父路径下生成一系列文件夹及文件</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/03/%E6%B5%B7%E8%B1%A1%E8%BF%90%E7%AE%97%E7%AC%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/03/%E6%B5%B7%E8%B1%A1%E8%BF%90%E7%AE%97%E7%AC%A6/" class="post-title-link" itemprop="url">海象运算符</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-10-03 10:27:39 / Modified: 10:47:10" itemprop="dateCreated datePublished" datetime="2021-10-03T10:27:39+08:00">2021-10-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">list_ = [x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意运算符优先级</span></span><br><span class="line"><span class="keyword">if</span> (list_length := <span class="built_in">len</span>(list_)) &gt; <span class="number">7</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;列表太长，长度：<span class="subst">&#123;list_length&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">list_ = [list_len:=<span class="built_in">len</span>(list_),list_len**<span class="number">2</span>,list_len**<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(list_)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若为true执行，false不执行</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">desc = <span class="string">&quot;hwc:19&quot;</span></span><br><span class="line"><span class="keyword">if</span> m := re.match(<span class="string">&quot;hwc:(.*)&quot;</span>,desc):</span><br><span class="line">    <span class="built_in">print</span>(m.group(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<h1 id="类型注解"><a href="#类型注解" class="headerlink" title="类型注解"></a>类型注解</h1><p>动态语言不需要声明变量类型，这种做法不太好</p>
<p>惯例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 隐式的说明变量类型</span></span><br><span class="line">course_dict = &#123;&#125;</span><br><span class="line">course_list = []</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显式说明，只起到一个提示作用，实际不会影响使用</span></span><br><span class="line">age: <span class="built_in">int</span> = <span class="number">18</span></span><br><span class="line">name: <span class="built_in">str</span> = <span class="string">&quot;hwc&quot;</span></span><br><span class="line">sex: <span class="built_in">bool</span> = <span class="literal">True</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/02/grpc%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/02/grpc%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">grpc入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-02 15:12:56" itemprop="dateCreated datePublished" datetime="2021-10-02T15:12:56+08:00">2021-10-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-10-05 22:00:44" itemprop="dateModified" datetime="2021-10-05T22:00:44+08:00">2021-10-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="protobuf"><a href="#protobuf" class="headerlink" title="protobuf"></a>protobuf</h1><p>Protocol Buffer：轻量高效结构化存储数据 </p>
<p>使用protobuf之前必须按格式写一个文件，根据这个文件生成各种脚本</p>
<p>以python为例：</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file:proto.hello</span></span><br><span class="line"><span class="comment">//必须标明版本</span></span><br><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//只能发送message类型</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloRequest</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> name = <span class="number">1</span>; <span class="comment">//name表示名称， name编号为1</span></span><br><span class="line">  <span class="built_in">string</span> date = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>命令行cd进文件夹后执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m grpc_tools.protoc --python_out=. --grpc_python_out=. -I. hello.proto</span><br></pre></td></tr></table></figure>

<p>生成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├─protobuf3_demo</span><br><span class="line">│  │  hello.proto</span><br><span class="line">│  │  hello_pb2.py</span><br><span class="line">│  │  hello_pb2_grpc.py</span><br></pre></td></tr></table></figure>

<p>记得改hello_pb2_grpc.py中import路径，否则会报错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line"><span class="keyword">from</span> protobuf3_demo <span class="keyword">import</span> hello_pb2</span><br><span class="line"></span><br><span class="line">request = hello_pb2.HelloRequest()</span><br><span class="line"></span><br><span class="line">request.name = <span class="string">&quot;hhhh&quot;</span></span><br><span class="line">request.date = <span class="string">&quot;2021.10.2&quot;</span></span><br><span class="line">req_str = request.SerializeToString()</span><br><span class="line"><span class="built_in">print</span>(req_str)</span><br><span class="line"></span><br><span class="line">request2 = hello_pb2.HelloRequest()</span><br><span class="line"></span><br><span class="line">request2.ParseFromString(req_str)</span><br><span class="line"><span class="built_in">print</span>(request2)</span><br></pre></td></tr></table></figure>

<h1 id="python-grpc-helloworld"><a href="#python-grpc-helloworld" class="headerlink" title="python grpc helloworld"></a>python grpc helloworld</h1><p>首先写.proto文件：</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> proto;<span class="comment">//不能不一样</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务名称</span></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 依次为：rpc关键字，函数名，函数参数，return关键字，返回值，函数内容体</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> SayHello (HelloRequest) <span class="keyword">returns</span> (HelloReply) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The request message containing the user&#x27;s name.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloRequest</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The response message containing the greetings</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloReply</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> <span class="class"><span class="keyword">message</span> = 1;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>

<p>执行命令并改import路径</p>
<p>完成操作后，开始写server和client</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</span><br><span class="line"><span class="keyword">from</span> proto <span class="keyword">import</span> hello_pb2,hello_pb2_grpc</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span>(<span class="params">hello_pb2_grpc.GreeterServicer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">SayHello</span>(<span class="params">self, request, context</span>):</span></span><br><span class="line">        <span class="keyword">return</span> hello_pb2.HelloReply(message=<span class="string">f&quot;hello,<span class="subst">&#123;request.name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 1，实例化server</span></span><br><span class="line">    server = grpc.server(futures.ThreadPoolExecutor(<span class="number">5</span>))</span><br><span class="line">    <span class="comment"># 2，注册逻辑到server中</span></span><br><span class="line">    hello_pb2_grpc.add_GreeterServicer_to_server(servicer=Greeter(),server=server)</span><br><span class="line">    <span class="comment"># 3，启动server</span></span><br><span class="line">    server.add_insecure_port(<span class="string">&#x27;127.0.0.1:50000&#x27;</span>)</span><br><span class="line">    server.start()</span><br><span class="line">    <span class="comment"># 4，让server保持服务</span></span><br><span class="line">    server.wait_for_termination()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">from</span> python_grpc_helloworld.proto <span class="keyword">import</span>  hello_pb2_grpc,hello_pb2</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> grpc.insecure_channel(<span class="string">&#x27;127.0.0.1:50000&#x27;</span>) <span class="keyword">as</span> channel:</span><br><span class="line">    stub = hello_pb2_grpc.GreeterStub(channel)</span><br><span class="line">    rsp: hello_pb2.HelloReply = stub.SayHello(hello_pb2.HelloRequest(name=<span class="string">&quot;lily&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(rsp.message)</span><br></pre></td></tr></table></figure>

<h1 id="python-concurrent-futures"><a href="#python-concurrent-futures" class="headerlink" title="python concurrent.futures"></a>python concurrent.futures</h1><ul>
<li><p>基本组成：</p>
<p>concurrent.futures.Executor类：虚拟基类，ThreadPoolExecutor是其子类</p>
<p>submit(function, argument)：调度函数执行，argument为参数</p>
<p>map(function,argument)：同上，但是以异步的方式调度函数</p>
<p>shutdown(Wait=True)：发出让执行者释放所有资源的信号，wait为True时等待任务完成，False时立即返回</p>
<p>concurrent.futures.Future：封装了异步执行，在executor.submit()时创建</p>
</li>
<li><p>concurrent.futures.ThreadPoolExecutor类</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concurrent.futures.ThreadPoolExecutor(max_workers=<span class="literal">None</span>, thread_name_prefix=<span class="string">&#x27;&#x27;</span>, initializer=<span class="literal">None</span>, initargs=())</span><br></pre></td></tr></table></figure>

<p>max_workers：最大线程数；若为None或没有指定，默认为机器处理器数量</p>
<p>这是一个线程池对象</p>
<h1 id="go-grpc-helloworld"><a href="#go-grpc-helloworld" class="headerlink" title="go grpc helloworld"></a>go grpc helloworld</h1><p>在go中写.proto文件，基本和python一样（除了option那一行，一定要完全一样）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> proto;<span class="comment">//不能不一样</span></span><br><span class="line">option go_package=<span class="string">&quot;./;proto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务名称</span></span><br><span class="line">service Greeter &#123;</span><br><span class="line">    <span class="comment">// 依次为：rpc关键字，函数名，函数参数，return关键字，返回值，函数内容体</span></span><br><span class="line">    rpc SayHello (HelloRequest) returns (HelloReply) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The request message containing the user&#x27;s name.</span></span><br><span class="line">message HelloRequest &#123;</span><br><span class="line">    <span class="keyword">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The response message containing the greetings</span></span><br><span class="line">message HelloReply &#123;</span><br><span class="line">    <span class="keyword">string</span> message = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>cd到目标文件下：</p>
<p>执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --go_out=plugins=grpc:./ ./hello.proto</span><br></pre></td></tr></table></figure>

<p>生成一个脚本文件</p>
<p>之后编写代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//服务端</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;awesomeProject/grpc_test/proto&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//简单的通信需要一个上下文对象</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Server)</span> <span class="title">SayHello</span><span class="params">(ctx context.Context, request *proto.HelloRequest)</span> <span class="params">(*proto.HelloReply,error)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;proto.HelloReply&#123;</span><br><span class="line">		Message: <span class="string">&quot;Hello&quot;</span> + request.Name,</span><br><span class="line">	&#125;,<span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	server := grpc.NewServer()</span><br><span class="line"> 	proto.RegisterGreeterServer(server,&amp;Server&#123;&#125;)</span><br><span class="line">    <span class="comment">//指定端口</span></span><br><span class="line">	listen,err := net.Listen(<span class="string">&quot;tcp&quot;</span>,<span class="string">&quot;127.0.0.1:50000&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;fail to listen:&quot;</span> + err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//开始监听</span></span><br><span class="line">	err = server.Serve(listen)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;fail to start:&quot;</span> + err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//客户端</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;awesomeProject/grpc_test/proto&quot;</span></span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	conn, err := grpc.Dial(<span class="string">&quot;127.0.0.1:50000&quot;</span>, grpc.WithInsecure())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;	</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">	c := proto.NewGreeterClient(conn)</span><br><span class="line">	resp, err := c.SayHello(context.Background(), &amp;proto.HelloRequest&#123;Name:<span class="string">&quot;Lily&quot;</span>&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(resp.Message)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="grpc-stream"><a href="#grpc-stream" class="headerlink" title="grpc stream"></a>grpc stream</h1><ul>
<li><p>简单模式(simple RPC)</p>
<p>客户端发起一个请求，服务端返回一个请求</p>
</li>
<li><p>服务端数据流模式(Server-side streaming RPC)</p>
<p>客户端发起一个请求，服务端返回一段连续的数据流（典型如客户端向服务端发送一个请求，服务端源源不断的返回数据）</p>
</li>
<li><p>客户端数据流模式(CLient-side streaming RPC)</p>
<p>客户端源源不断的发送数据，发送结束后，客户端返回一个响应（如物联网终端向服务器报送数据）</p>
</li>
<li><p>双向数据流模式(Bidirectional streaming RPC)</p>
<p>实现实时交互（如聊天）</p>
</li>
</ul>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> go_package = <span class="string">&quot;./;proto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">Greeter</span></span>&#123;</span><br><span class="line">    <span class="comment">//stream关键字表明是数据流</span></span><br><span class="line">    <span class="function"><span class="keyword">rpc</span> GetStream(StreamReqData) <span class="keyword">returns</span> (stream StreamResData)</span>; <span class="comment">//服务端流模式</span></span><br><span class="line">    <span class="function"><span class="keyword">rpc</span> PutStream(stream StreamReqData) <span class="keyword">returns</span> (StreamResData)</span>; <span class="comment">//客户端流模式</span></span><br><span class="line">    <span class="function"><span class="keyword">rpc</span> AllStream(stream StreamReqData) <span class="keyword">returns</span> (stream StreamResData)</span>; <span class="comment">//双向流模式</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">StreamReqData</span> </span>&#123;</span><br><span class="line">    <span class="built_in">string</span> data = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">StreamResData</span> </span>&#123;</span><br><span class="line">    <span class="built_in">string</span> data = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;awesomeProject/stream_grpc_test/proto&quot;</span></span><br><span class="line">   <span class="string">&quot;errors&quot;</span></span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">   <span class="string">&quot;log&quot;</span></span><br><span class="line">   <span class="string">&quot;net&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="string">&quot;:50000&quot;</span></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端 单向流</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Server)</span><span class="title">GetStream</span><span class="params">(req *proto.StreamReqData,serveStream proto.Greeter_GetStreamServer)</span> <span class="title">error</span></span>&#123;</span><br><span class="line">   <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++ &#123;</span><br><span class="line">      err := serveStream.Send(&amp;proto.StreamResData&#123;</span><br><span class="line">         Data: time.Now().String(),</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">         <span class="built_in">panic</span>(err.Error())</span><br><span class="line">      &#125;</span><br><span class="line">      time.Sleep(time.Second)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端 单向流</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Server)</span><span class="title">PutStream</span><span class="params">(clientStream proto.Greeter_PutStreamServer)</span> <span class="title">error</span></span>&#123;</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      a,err := clientStream.Recv()</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">         <span class="keyword">return</span> errors.New(<span class="string">&quot;fail to receive data:&quot;</span>+err.Error())</span><br><span class="line">      &#125;</span><br><span class="line">      log.Println(a.Data)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 双向流</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Server)</span><span class="title">AllStream</span><span class="params">(allStream proto.Greeter_AllStreamServer)</span> <span class="title">error</span></span>&#123;</span><br><span class="line">   wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">   wg.Add(<span class="number">2</span>)</span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">defer</span> wg.Done()</span><br><span class="line">      <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">         err := allStream.Send(&amp;proto.StreamResData&#123;Data: time.Now().String()&#125;)</span><br><span class="line">         <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;allStream sending goes wrong:&quot;</span>+err.Error())</span><br><span class="line">         &#125;</span><br><span class="line">         time.Sleep(time.Second)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">defer</span> wg.Done()</span><br><span class="line">      <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">         data,err := allStream.Recv()</span><br><span class="line">         <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;allStream sending goes wrong:&quot;</span>+err.Error())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">         &#125;</span><br><span class="line">         fmt.Println(data)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line">   wg.Wait()</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">   server := grpc.NewServer()</span><br><span class="line">   proto.RegisterGreeterServer(server,&amp;Server&#123;&#125;)</span><br><span class="line">   listen,err := net.Listen(<span class="string">&quot;tcp&quot;</span>,PORT)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">      <span class="built_in">panic</span>(err.Error())</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   err = server.Serve(listen)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">      <span class="built_in">panic</span>(err.Error())</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//client</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;awesomeProject/stream_grpc_test/proto&quot;</span></span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ADDR = <span class="string">&quot;127.0.0.1:50000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	conn, err := grpc.Dial(ADDR,grpc.WithInsecure())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="built_in">panic</span>(err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">	c := proto.NewGreeterClient(conn)</span><br><span class="line">	<span class="comment">// 服务端 流模式</span></span><br><span class="line">	res,err := c.GetStream(context.Background(),&amp;proto.StreamReqData&#123;Data: <span class="string">&quot;Hello,Lily!&quot;</span>&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;fail to send message:&quot;</span>+err.Error())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		a,err := res.Recv()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">			log.Println(<span class="string">&quot;fail to receive data:&quot;</span>+err.Error())</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		log.Println(a)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 客户端 流模式</span></span><br><span class="line">	putStream,err := c.PutStream(context.Background())</span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">		err = putStream.Send(&amp;proto.StreamReqData&#123;Data: time.Now().String()&#125;)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">			log.Println(<span class="string">&quot;fail to send stream:&quot;</span>+err.Error())</span><br><span class="line">		&#125;</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 双向流模式</span></span><br><span class="line">	allStream,err := c.AllStream(context.Background())</span><br><span class="line">	wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		<span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">			err := allStream.Send(&amp;proto.StreamReqData&#123;Data: time.Now().String()&#125;)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">				fmt.Println(<span class="string">&quot;allStream sending goes wrong:&quot;</span>+err.Error())</span><br><span class="line">			&#125;</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		<span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">			data,err := allStream.Recv()</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">				fmt.Println(<span class="string">&quot;allStream sending goes wrong:&quot;</span>+err.Error())</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">			fmt.Println(data)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	wg.Wait()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/02/python%E7%94%9F%E6%88%90%E5%99%A8%E5%92%8C%E8%BF%AD%E4%BB%A3%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/02/python%E7%94%9F%E6%88%90%E5%99%A8%E5%92%8C%E8%BF%AD%E4%BB%A3%E5%99%A8/" class="post-title-link" itemprop="url">python生成器和迭代器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-10-02 11:05:51 / Modified: 14:36:00" itemprop="dateCreated datePublished" datetime="2021-10-02T11:05:51+08:00">2021-10-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h1><p><img src="https://pica.zhimg.com/v2-861dbd78bc8ddb5c5cc83ffd54f3d1e3_1440w.jpg?source=172ae18b" alt="【进阶Python】第五讲：迭代器与生成器"></p>
<p>实现：</p>
<ul>
<li>可迭代对象只需要实现iter方法</li>
<li>迭代器还需要实现next方法，使用next访问非迭代器会报错</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Iterator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,array</span>):</span></span><br><span class="line">        self.array = array</span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span>(self.index &lt; <span class="built_in">len</span>(self.array)):</span><br><span class="line">            result = self.array[self.index]</span><br><span class="line">            self.index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line">it = Iterator([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> it:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 啥也没输出</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> it:</span><br><span class="line">    <span class="built_in">print</span>(t)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时再迭代会报错</span></span><br><span class="line"><span class="comment"># print(next(it))</span></span><br><span class="line"><span class="comment"># print(next(it))</span></span><br><span class="line"><span class="comment"># print(next(it))</span></span><br><span class="line"><span class="comment"># print(next(it))</span></span><br><span class="line"><span class="comment"># print(next(it))</span></span><br><span class="line"><span class="comment"># print(next(it))   </span></span><br></pre></td></tr></table></figure>

<h1 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h1><p>定义：一边循环一边计算的机制，叫做生成器：generator</p>
<p>生成器的用途：列表所有数据存储在内存中，若数据量过多非常消耗内存。若列表中元素按照某种算法推演出来，那么可以一边循环一边计算后面的元素，而不必生成完整列表，从而节省大量空间。</p>
<p>方法一：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list_ = [x+x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(list_)) <span class="comment"># list</span></span><br><span class="line">list__ = (x+x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(list__)) <span class="comment"># generator</span></span><br></pre></td></tr></table></figure>

<p>方法二：</p>
<p>函数中加yield：yield相当于return一个值，并记住位置，下次调用函数从该yield语句之后执行</p>
<p>send()与next()一样，都可以让generator走一步，但send()可以传一个值，修改上一个yield表达式</p>
<p>如：a = yield 5，第一次运行到这里时返回5，a未被赋值；这时使用.send(10)，就会赋10给a</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:UTF-8</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">yield_test</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">yield</span> call(i)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;i=&quot;</span>,i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Done.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">return</span> i*<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> yield_test(<span class="number">5</span>):</span><br><span class="line">    <span class="built_in">print</span>(i,<span class="string">&quot;,&quot;</span>)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/01/python%E5%A4%9A%E7%BA%BF%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/01/python%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="post-title-link" itemprop="url">python多线程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-01 20:28:16" itemprop="dateCreated datePublished" datetime="2021-10-01T20:28:16+08:00">2021-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-10-02 11:25:00" itemprop="dateModified" datetime="2021-10-02T11:25:00+08:00">2021-10-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="线程对象：threading-Thread"><a href="#线程对象：threading-Thread" class="headerlink" title="线程对象：threading.Thread"></a>线程对象：threading.Thread</h1><p>threading.Thread(group=None, target=None, name=None, args=(), kwargs={}, *, daemon=None)</p>
<ul>
<li>traget：该线程要调用的函数</li>
<li>args：该线程要传入的参数，元组形式，默认为空元组，可以和kwargs一起使用</li>
<li>kwargs：该线程要传入的参数，字典形式</li>
</ul>
<p>方法：</p>
<ul>
<li><p>sart()：开启一个线程，使run()方法在一个线程中被调用</p>
</li>
<li><p>run()：主要用去创建子类时重写</p>
</li>
<li><p>join()：确保调用该方法的线程执行完之后再执行下一个线程</p>
</li>
<li><p>is_alive()：判断该线程是否存活</p>
</li>
<li><p>daemon()：判断该线程是否是守护线程。所有在主线程中创建的线程默认都是非守护线程。</p>
</li>
</ul>
<p>补充：</p>
<ul>
<li>守护线程：只有当所有守护线程都结束，python程序才会退出。若python程序退出，那么所有的守护线程都会被终止，从而结束程序</li>
<li>非守护线程：当python程序结束时，若还有非守护线程在运行，那么会等到所有非守护线程结束才会退出</li>
</ul>
<p>示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">通过继承threading.Thread的子类创建线程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestThread</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, para=<span class="string">&#x27;hi&#x27;</span>, sleep=<span class="number">3</span></span>):</span></span><br><span class="line">        <span class="comment"># 重写threading.Thread的__init__方法时，确保在所有操作之前先调用threading.Thread.__init__方法</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.para = para</span><br><span class="line">        self.sleep = sleep</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;线程内容&quot;&quot;&quot;</span></span><br><span class="line">        time.sleep(self.sleep)</span><br><span class="line">        <span class="built_in">print</span>(self.para)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 创建线程</span></span><br><span class="line">    thread_hi = TestThread()</span><br><span class="line">    thread_hello = TestThread(<span class="string">&#x27;hello&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 启动线程</span></span><br><span class="line">    thread_hi.start()</span><br><span class="line">    thread_hello.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Main thread has ended!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">使用join方法阻塞主线程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_thread</span>(<span class="params">para=<span class="string">&#x27;hi&#x27;</span>, sleep=<span class="number">5</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;线程运行函数&quot;&quot;&quot;</span></span><br><span class="line">    time.sleep(sleep)</span><br><span class="line">    <span class="built_in">print</span>(para)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 创建线程</span></span><br><span class="line">    thread_hi = threading.Thread(target=test_thread)</span><br><span class="line">    thread_hello = threading.Thread(target=test_thread, args=(<span class="string">&#x27;hello&#x27;</span>, <span class="number">1</span>))</span><br><span class="line">    <span class="comment"># 启动线程</span></span><br><span class="line">    thread_hi.start()</span><br><span class="line">    thread_hello.start()</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;马上执行join方法了&#x27;</span>)</span><br><span class="line">    <span class="comment"># 执行join方法会阻塞调用线程（主线程），直到调用join方法的线程（thread_hi）结束</span></span><br><span class="line">    thread_hi.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;线程thread_hi已结束&#x27;</span>)</span><br><span class="line">    <span class="comment"># 这里不会阻塞主线程，因为运行到这里的时候，线程thread_hello已经运行结束了</span></span><br><span class="line">    thread_hello.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Main thread has ended!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 以上代码只是为了展示join方法的效果</span></span><br><span class="line">    <span class="comment"># 如果想要等所有线程都运行完成后再做其他操作，可以使用for循环</span></span><br><span class="line">    <span class="comment"># for thd in (thread_hi, thread_hello):</span></span><br><span class="line">    <span class="comment">#     thd.join()</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># print(&#x27;所有线程执行结束后的其他操作&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h1 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h1><ul>
<li>锁只有锁定与非锁定两种状态</li>
<li>当一个锁被锁定时，它并不属于某一个线程</li>
<li>锁被创建时，处于非锁定状态，使用acquire()方法来锁定锁；一个锁定的锁无法再次获得</li>
<li>使用release()来释放一个锁，不只是获得锁的线程可以释放锁</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">使用锁实现线程同步</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建锁</span></span><br><span class="line">lock = threading.Lock()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局变量</span></span><br><span class="line">global_resource = [<span class="literal">None</span>] * <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_resource</span>(<span class="params">para, sleep</span>):</span></span><br><span class="line">    <span class="comment"># 请求锁</span></span><br><span class="line">    lock.acquire()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这段代码如果不加锁，第一个线程运行结束后global_resource中是乱的，输出为：修改全局变量为： [&#x27;hello&#x27;, &#x27;hi&#x27;, &#x27;hi&#x27;, &#x27;hello&#x27;, &#x27;hello&#x27;]</span></span><br><span class="line">    <span class="comment"># 第二个线程运行结束后，global_resource中还是乱的，输出为：修改全局变量为： [&#x27;hello&#x27;, &#x27;hi&#x27;, &#x27;hi&#x27;, &#x27;hi&#x27;, &#x27;hi&#x27;]</span></span><br><span class="line">    <span class="comment"># 若想在函数内部对函数外的变量进行操作，就需要在函数内部声明其为global</span></span><br><span class="line">    <span class="keyword">global</span> global_resource</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(global_resource)):</span><br><span class="line">        global_resource[i] = para</span><br><span class="line">        time.sleep(sleep)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;修改全局变量为：&quot;</span>, global_resource)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 释放锁</span></span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    thread_hi = threading.Thread(target=change_resource, args=(<span class="string">&#x27;hi&#x27;</span>, <span class="number">2</span>))</span><br><span class="line">    thread_hello = threading.Thread(target=change_resource, args=(<span class="string">&#x27;hello&#x27;</span>, <span class="number">1</span>))</span><br><span class="line">    thread_hi.start()</span><br><span class="line">    thread_hello.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h1 id="递归锁"><a href="#递归锁" class="headerlink" title="递归锁"></a>递归锁</h1><ul>
<li>释放递归锁的操作必须由获得该锁的线程来进行（同一递归等级）</li>
<li>同一个线程在释放锁之前再次获得锁不会阻塞该线程，而是将递归等级加一（初始递归等级为1）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">在普通锁中可能造成死锁的情况，可以考虑使用递归锁解决</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是使用的两个普通锁，那么就会造成死锁的情况，程序一直阻塞而不会退出</span></span><br><span class="line"><span class="comment"># rlock_hi = threading.Lock()</span></span><br><span class="line"><span class="comment"># rlock_hello = threading.Lock()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用成一个递归锁就可以解决当前这种死锁情况</span></span><br><span class="line">rlock_hi = rlock_hello = threading.RLock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_thread_hi</span>():</span></span><br><span class="line">    <span class="comment"># 初始时锁内部的递归等级为1</span></span><br><span class="line">    rlock_hi.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;线程test_thread_hi获得了锁rlock_hi&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 如果再次获取同样一把锁，则不会阻塞，只是内部的递归等级加1</span></span><br><span class="line">    rlock_hello.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;线程test_thread_hi获得了锁rlock_hello&#x27;</span>)</span><br><span class="line">    <span class="comment"># 释放一次锁，内部递归等级减1</span></span><br><span class="line">    rlock_hello.release()</span><br><span class="line">    <span class="comment"># 这里再次减，当递归等级为0时，其他线程才可获取到此锁</span></span><br><span class="line">    rlock_hi.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_thread_hello</span>():</span></span><br><span class="line">    rlock_hello.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;线程test_thread_hello获得了锁rlock_hello&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    rlock_hi.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;线程test_thread_hello获得了锁rlock_hi&#x27;</span>)</span><br><span class="line">    rlock_hi.release()</span><br><span class="line">    rlock_hello.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    thread_hi = threading.Thread(target=test_thread_hi)</span><br><span class="line">    thread_hello = threading.Thread(target=test_thread_hello)</span><br><span class="line">    thread_hi.start()</span><br><span class="line">    thread_hello.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h1 id="条件变量对象"><a href="#条件变量对象" class="headerlink" title="条件变量对象"></a>条件变量对象</h1><p>补充：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="literal">True</span> == <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="literal">True</span> == <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="literal">False</span> == <span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="literal">False</span> == <span class="number">2</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>threading.Condition(lock=None)：一个条件变量对象允许一个或多个线程等待，直到被另一个线程通知    </p>
<p>方法：</p>
<ul>
<li>wait(timeout=None)：释放锁，等待直到被通知或超时，等待的时间内阻塞线程。</li>
<li>wait_for(predicate,timeout=None)：与wait方法类似，等待。这个方法首先调用predicate函数，判断其返回值，若为true，释放锁，并阻塞，待被通知或超时后，调用predicate函数，返回true，则获得锁，不再阻塞；若为false，继续阻塞；若为false，则不会释放锁，程序继续执行。</li>
<li>notify(n=1)：唤醒n个正在等待这个条件变量的线程</li>
<li>notify_all()：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">让一个线程等待，直到另一个线程通知</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建条件变量对象</span></span><br><span class="line">condition_lock = threading.Condition()</span><br><span class="line"></span><br><span class="line">PRE = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># predicate可调用函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pre</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(PRE)</span><br><span class="line">    <span class="keyword">return</span> PRE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_thread_hi</span>():</span></span><br><span class="line">    <span class="comment"># 在使用wait/wait_for之前必须先获得锁</span></span><br><span class="line">    condition_lock.acquire()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;等待线程test_thread_hello的通知&#x27;</span>)</span><br><span class="line">    <span class="comment"># 先执行一次pre，返回False后释放掉锁，等另一个线程释放掉锁后再次执行pre，返回True后再次获取锁</span></span><br><span class="line">    <span class="comment"># wait_for的返回值不是True和False，而是predicate参数的返回值</span></span><br><span class="line">    condition_lock.wait_for(pre)</span><br><span class="line">    <span class="comment"># condition_lock.wait()</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;继续执行&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 不要忘记使用wait/wait_for之后要释放锁</span></span><br><span class="line">    condition_lock.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_thread_hello</span>():</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    condition_lock.acquire()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">global</span> PRE</span><br><span class="line">    PRE = <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;修改PRE值为1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;通知线程test_thread_hi可以准备获取锁了&#x27;</span>)</span><br><span class="line">    condition_lock.notify()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 先notify/notify_all之后在释放锁</span></span><br><span class="line">    condition_lock.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;你获取锁吧&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    thread_hi = threading.Thread(target=test_thread_hi)</span><br><span class="line">    thread_hello = threading.Thread(target=test_thread_hello)</span><br><span class="line">    thread_hi.start()</span><br><span class="line">    thread_hello.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/27/go-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/27/go-1/" class="post-title-link" itemprop="url">go(1)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-09-27 19:49:50" itemprop="dateCreated datePublished" datetime="2021-09-27T19:49:50+08:00">2021-09-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-09-30 15:19:25" itemprop="dateModified" datetime="2021-09-30T15:19:25+08:00">2021-09-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="惊鸿一瞥"><a href="#惊鸿一瞥" class="headerlink" title="惊鸿一瞥"></a>惊鸿一瞥</h1><h2 id="Hello，World"><a href="#Hello，World" class="headerlink" title="Hello，World"></a>Hello，World</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main	</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>package关键字声明代码所属的包，本例中包名为main。<br>import关键字导入需要的包<br>func关键字声明函数<br>当运行一个Go程序，总是从main包的main函数开始</p>
<p>fmt包：format之缩写，提供格式化输入输出函数</p>
<p>此外，大括号有其唯一的制定格式</p>
<h2 id="基本知识"><a href="#基本知识" class="headerlink" title="基本知识"></a>基本知识</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//声明常量</span></span><br><span class="line">	<span class="keyword">const</span> ( days = <span class="number">365</span></span><br><span class="line">           name = <span class="string">&quot;days&quot;</span></span><br><span class="line">          )</span><br><span class="line">	<span class="comment">//声明变量</span></span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		dream = <span class="string">&quot;I have a dream&quot;</span></span><br><span class="line">		new_dream = <span class="string">&quot;I had a dream&quot;</span></span><br><span class="line">	)</span><br><span class="line">	<span class="comment">//格式化输出</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;One year has&quot;</span>,days,name)</span><br><span class="line">	fmt.Print(<span class="string">&quot;One year has &quot;</span>)</span><br><span class="line">	fmt.Print(days)</span><br><span class="line">	fmt.Print(<span class="string">&quot; days\n&quot;</span>)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;One year has %d days\n&quot;</span>,days)</span><br><span class="line">	fmt.Println(dream,<span class="string">&quot;\n&quot;</span>,new_dream)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Println会自动补换行符</p>
<p>Go中运算符和C中大抵相同，但没有++count这种前置增量操作</p>
<h2 id="基本控制结构"><a href="#基本控制结构" class="headerlink" title="基本控制结构"></a>基本控制结构</h2><p>在go中，true是唯一真值，false是唯一假值</p>
<p>比较运算符：==,!=,&lt;=,&lt;,&gt;=,&gt;</p>
<p>Go不允许文本和数值直接比较</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> 判断语句&#123;</span><br><span class="line">		<span class="comment">//do sth.</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> 判断语句&#123;</span><br><span class="line">		<span class="comment">//do sth.</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> 判断语句&#123;</span><br><span class="line">		<span class="comment">//do sth.</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>逻辑与：&amp;&amp;<br>逻辑或：||<br>逻辑非：！</p>
<p>Switch实现分支判断：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">const</span> days = <span class="number">365</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> days &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">100</span>:</span><br><span class="line">		fmt.Println(<span class="number">100</span>,<span class="string">&quot;days&quot;</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="number">200</span>,<span class="number">365</span>:<span class="comment">//使用逗号分隔多个可选值</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;hhhh&quot;</span>)</span><br><span class="line">		<span class="keyword">fallthrough</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">&quot;23333333&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>for实现循环结构<br>关于range关键字：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//假设array_cut是一个数组或切片</span></span><br><span class="line"><span class="comment">//index和value分别对应了下标和值</span></span><br><span class="line"><span class="keyword">for</span> index,value := <span class="keyword">range</span> array_cut&#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>go作用域：以大括号分界<br>虽然没有用到大括号，但default和case都i引入了新的作用域</p>
<p>简短声明：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//两方法等价</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;ubuntu&#x27;</span></span><br><span class="line">name := <span class="string">&#x27;ubuntu&#x27;</span></span><br></pre></td></tr></table></figure>

<p>简短声明作用：<br>以下三种情况，变量作用域都在大括号内<br>这种使用方法无法用var声明替代</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> count := <span class="number">10</span>; count &gt; <span class="number">0</span>;count--&#123;</span><br><span class="line">	<span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> count := rand.Intn(<span class="number">3</span>); count == <span class="number">0</span>&#123;</span><br><span class="line">	<span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> num := rand(<span class="number">10</span>); num&#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h1><h2 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//双精度浮点数</span></span><br><span class="line">age := <span class="number">19.2</span></span><br><span class="line"><span class="keyword">var</span> age =<span class="number">19.2</span></span><br><span class="line"><span class="keyword">var</span> age <span class="keyword">float64</span> = <span class="number">19.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//单精度浮点数</span></span><br><span class="line"><span class="keyword">var</span> age <span class="keyword">float32</span> = <span class="number">19.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//默认零值</span></span><br><span class="line"><span class="keyword">var</span> age</span><br></pre></td></tr></table></figure>

<h2 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">year := <span class="number">2021</span></span><br><span class="line"><span class="keyword">var</span> year = <span class="number">2021</span></span><br><span class="line"><span class="keyword">var</span> year <span class="keyword">int</span> <span class="number">2021</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//e12表示10的12次方</span></span><br><span class="line"><span class="keyword">var</span> distance <span class="keyword">int64</span>  = <span class="number">2.33e12</span></span><br></pre></td></tr></table></figure>

<h2 id="big包"><a href="#big包" class="headerlink" title="big包"></a>big包</h2><p>big包提供3种类型：</p>
<ul>
<li>存储大整数big.Int</li>
<li>存储任意精度浮点数big.Float</li>
<li>存储分数big.Rat</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建int64类型</span></span><br><span class="line">hhhhh := big.NewInt(<span class="number">2333333</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建很大很大的数</span></span><br><span class="line">hhhhhhh := <span class="built_in">new</span>(big.Int)</span><br><span class="line">hhhhhhh.SetString(<span class="string">&quot;23333333333333333&quot;</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Go语言不会为常量推断类型，而是默认无类型（untyped）</span></span><br><span class="line"><span class="comment">//由big包提供底层支持</span></span><br><span class="line"><span class="keyword">const</span> distance = <span class="number">23333333333333333333333333</span></span><br></pre></td></tr></table></figure>

<h2 id="多语言文本"><a href="#多语言文本" class="headerlink" title="多语言文本"></a>多语言文本</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go语言推断双引号内字面值为string类型</span></span><br><span class="line">peace := <span class="string">&quot;peace&quot;</span></span><br><span class="line"><span class="keyword">var</span> peace = <span class="string">&quot;peace&quot;</span></span><br><span class="line"><span class="keyword">var</span> peace <span class="keyword">string</span> = <span class="string">&quot;peace&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//声明零值</span></span><br><span class="line"><span class="keyword">var</span> peace <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//反引号包围的文本不考虑转义字符`</span></span><br><span class="line"><span class="keyword">var</span> peace <span class="string">&#x27;hhhhhhh\n&#x27;</span><span class="comment">//不会输出换行符，而是输出/n</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//反引号可跨越多行，打印时将包含这些行</span></span><br><span class="line"><span class="keyword">var</span> peace <span class="string">&#x27;hhhhh</span></span><br><span class="line"><span class="string">hhhhhhhh</span></span><br><span class="line"><span class="string">hhhhh&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以独立访问字符串中的单个字符，但无法单独修改</span></span><br><span class="line">hhhh = <span class="string">&#x27;laugh&#x27;</span></span><br><span class="line">h = laugh[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//非法操作：</span></span><br><span class="line">laugh[<span class="number">4</span>] = <span class="string">&#x27;d&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><p>类型转换：<br>转换一个变量，只需用与目标类型同名的函数来包裹该变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字符串拼接</span></span><br><span class="line">hhhh = <span class="string">&#x27;laugh &#x27;</span> + <span class="string">&#x27;is the power of birth.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//非法：</span></span><br><span class="line">hhh =<span class="string">&#x27;laugh &#x27;</span> + <span class="string">&#x27;is the power of birth.&#x27;</span> + <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//合法</span></span><br><span class="line">hhh = <span class="string">&#x27;laugh &#x27;</span> + <span class="string">&#x27;is the power of birth.&#x27;</span> + <span class="string">&#x27;10&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这部分与c语言大致相同<br>浮点数转换为整数，没有任何舍入，而是直接截断</p>
<p>关于字符串转换</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据代码点转换</span></span><br><span class="line">fmt.Println(<span class="keyword">string</span>(<span class="number">960</span>),<span class="keyword">string</span>(<span class="number">940</span>),<span class="keyword">string</span>(<span class="number">969</span>),<span class="keyword">string</span>(<span class="number">33</span>))</span><br><span class="line"><span class="comment">//输出π ά ω !</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//转换为字符串方法：</span></span><br><span class="line"><span class="comment">//使用strconv包的Itoa函数</span></span><br><span class="line">hhh =<span class="string">&#x27;laugh &#x27;</span> + <span class="string">&#x27;is the power of birth.&#x27;</span> + strconv.Itoa(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//字符串转换为整数</span></span><br><span class="line"><span class="comment">//使用strconv包的Atoi函数</span></span><br><span class="line"><span class="keyword">const</span> hhh <span class="keyword">string</span> = <span class="string">&#x27;23333&#x27;</span></span><br><span class="line">number := strconv.Atoi(hhh)</span><br></pre></td></tr></table></figure>
<p>代码点：<br>一个数字对应一个特殊字符<br>如：π ά ω !分别对应960 940 969 33</p>
<h1 id="构建块"><a href="#构建块" class="headerlink" title="构建块"></a>构建块</h1><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>基本格式：</p>
<blockquote>
<p><code>func function_name( [parameter list] ) [return_types] &#123; 函数体 &#125;</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(number1 <span class="keyword">int</span>,number2 <span class="keyword">int</span>)</span><span class="params">(sum <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	sum = number1 + number2</span><br><span class="line">	<span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(number1 <span class="keyword">int</span>,number2 <span class="keyword">int</span>)</span><span class="params">(sum <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	sum = number1 + number2</span><br><span class="line">	<span class="keyword">return</span> <span class="comment">//省略了返回值的名字</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Calculate</span><span class="params">(number1 ,number2 <span class="keyword">int</span>)</span><span class="params">(sum,multitude <span class="keyword">int</span>)</span></span>&#123;<span class="comment">//减少了int的使用次数</span></span><br><span class="line">	sum = number1 + number2</span><br><span class="line">	multitude = number2*number1</span><br><span class="line">	<span class="keyword">return</span> sum,multitude</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Calculate</span><span class="params">(number1 ,number2 <span class="keyword">int</span>)</span><span class="params">(sum,multitude <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	sum = number1 + number2</span><br><span class="line">	multitude = number2*number1</span><br><span class="line">	<span class="keyword">return</span> </span><br></pre></td></tr></table></figure>

<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>声明新类型：<br>格式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> 新类型名称 底层类型</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> type1 <span class="keyword">float64</span></span><br><span class="line"><span class="keyword">type</span> type2 <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> number1 type1 := <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> number2 type2 := <span class="number">15</span></span><br><span class="line"><span class="keyword">var</span> number3 <span class="keyword">float64</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//以下操作非法.尽管底层相同，他们仍为不同的类型</span></span><br><span class="line">numebr1 = number2</span><br><span class="line">number2 = number3</span><br></pre></td></tr></table></figure>

<p>在go语言中，没有类和对象<br>格式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(接受者)</span> 方法名<span class="params">(形参列表)</span> （返回值列表）</span>&#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接受者是某种非内置类型的变量<br>用于建立类型和方法之间的关联</p>
<p>实例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(number1 myInt)</span> <span class="title">calculate</span><span class="params">(number2 <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>,multitude <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">int</span>(number1)+number2,<span class="keyword">int</span>(number1)*number2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> number1 myInt = <span class="number">10</span></span><br><span class="line">	<span class="keyword">var</span> number2 =<span class="number">20</span></span><br><span class="line">	<span class="keyword">var</span> sum <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">var</span> multitude <span class="keyword">int</span></span><br><span class="line">	sum,multitude = number1.calculate(number2)</span><br><span class="line">	fmt.Println(sum,multitude)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一等函数"><a href="#一等函数" class="headerlink" title="一等函数"></a>一等函数</h2><p>在go中，函数是 一等 值，可以把函数赋值给变量，可以把函数传递给函数，也可以编写创建并返回函数的函数。</p>
<p>将函数赋值给变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(number1,number2 <span class="keyword">int</span>)</span> <span class="title">myInt</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> myInt(number1+number2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Multitude</span><span class="params">(number1,number2 <span class="keyword">int</span>)</span> <span class="title">myInt</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> myInt(number1*number2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//将函数赋值给变量方法一：</span></span><br><span class="line">	func1 := Add</span><br><span class="line">	<span class="comment">//将函数赋值给变量方法二</span></span><br><span class="line">	<span class="keyword">var</span> func2 <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span> <span class="title">myInt</span> = <span class="title">Multitude</span></span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> number1 <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">	<span class="keyword">var</span> number2 <span class="keyword">int</span> = <span class="number">20</span></span><br><span class="line">	<span class="keyword">var</span> result myInt</span><br><span class="line"></span><br><span class="line">	result = func1(number1,number2)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">	result = func2(number1,number2)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line"></span><br><span class="line">	func1 = func2</span><br><span class="line">	result = func1(number1,number2)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">	func2 = Add</span><br><span class="line">	result = func2(number1,number2)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将函数传递给其他函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int64</span></span><br><span class="line"><span class="comment">//声明函数类型</span></span><br><span class="line"><span class="keyword">type</span> myFunc <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span> <span class="title">myInt</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(number1,number2 <span class="keyword">int</span>)</span> <span class="title">myInt</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> myInt(number1+number2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Multitude</span><span class="params">(number1,number2 <span class="keyword">int</span>)</span> <span class="title">myInt</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> myInt(number1*number2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add_Multitude</span><span class="params">(number1,number2 <span class="keyword">int</span>, func1,func2 myFunc)</span> <span class="params">(sum,multitude myInt)</span></span>&#123;</span><br><span class="line">	sum = func1(number1,number2)</span><br><span class="line">	multitude = func2(number1,number2)</span><br><span class="line">	<span class="keyword">return</span> sum,multitude</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="闭包和匿名函数"><a href="#闭包和匿名函数" class="headerlink" title="闭包和匿名函数"></a>闭包和匿名函数</h2><p>匿名函数在Go中也称为函数字面量</p>
<p>闭包函数：声明在一个函数内部的函数<br>闭包：内部函数总是可以访问其所在外部函数中的变量，即使它所在的外部函数已返回（寿命终结）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> myFunc <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func1</span><span class="params">(func2 myFunc,offset <span class="keyword">int</span>)</span> <span class="title">myFunc</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> func2() + offset</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func2</span><span class="params">()</span> <span class="title">int</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//匿名函数赋值给变量</span></span><br><span class="line">	func4 := <span class="function"><span class="keyword">func</span><span class="params">(message <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">		fmt.Println(message)</span><br><span class="line">	&#125;</span><br><span class="line">	func4(<span class="string">&quot;hhhhhhhhhhhhhhhhhhhhhhh&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//同时声明和调用匿名函数</span></span><br><span class="line">	<span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;hhhhhhhhh&quot;</span>)</span><br><span class="line">	&#125; ()</span><br><span class="line"></span><br><span class="line">	<span class="comment">//从函数里返回另一个函数</span></span><br><span class="line">	func3 := func1(func2,<span class="number">20</span>)</span><br><span class="line">	fmt.Println(func3())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="可变参数函数"><a href="#可变参数函数" class="headerlink" title="可变参数函数"></a>可变参数函数</h2><p><img src="https://img-blog.csdnimg.cn/20210610202812183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMTAyMzUw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>声明放在函数形参的最后一位<br>可以传入多个参数或不传参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(name...<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cut_test := []<span class="keyword">string</span>&#123;<span class="string">&quot;sss&quot;</span>,<span class="string">&quot;hhh&quot;</span>,<span class="string">&quot;2333&quot;</span>&#125;</span><br><span class="line"><span class="comment">//将cut_test的多个元素传递给函数</span></span><br><span class="line">cut = f(cut_test..)</span><br></pre></td></tr></table></figure>



<h1 id="收集器"><a href="#收集器" class="headerlink" title="收集器"></a>收集器</h1><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> planests [<span class="number">8</span>]<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">planest[<span class="number">0</span>] = <span class="string">&quot;Mercury&quot;</span></span><br><span class="line">mercury := planets[<span class="number">0</span>]</span><br><span class="line">fmt.Println(<span class="built_in">len</span>(planest))<span class="comment">//输出8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//未赋值的元素将默认为零值</span></span><br><span class="line"><span class="keyword">var</span> numbers = [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//也可以不用指定数组长度</span></span><br><span class="line"><span class="keyword">var</span> numbers = [...]<span class="keyword">int</span>&#123;</span><br><span class="line"><span class="number">1</span>,</span><br><span class="line"><span class="number">2</span>,</span><br><span class="line"><span class="number">3</span>,</span><br><span class="line">&#125;<span class="comment">//结尾逗号是必需的</span></span><br></pre></td></tr></table></figure>
<p>数组用于赋值或传递给参数时会产生一个副本<br>故函数内部对数组的修改不会影响原数组</p>
<p>数组嵌套定义即形成所谓的多维数组</p>
<h2 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h2><ul>
<li>对于数组</li>
</ul>
<p>切片数组不会导致数组被修改，只是创建了指向数组的视图，把该视图称为切片类型</p>
<p>格外注意的是，切片或切片的切片都是数组的视图，对他们进行修改会导致原数组的修改</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sort&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	numbers := [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">	cut1 := numbers[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">	cut2 := numbers[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">	fmt.Println(numbers,cut1,cut2)</span><br><span class="line">	cut2[<span class="number">1</span>] = <span class="number">100</span></span><br><span class="line">	fmt.Println(numbers)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//可以切割string类型，将创建另一个字符串，两个字符串相互独立</span></span><br><span class="line">	name  := <span class="string">&quot;yangzi&quot;</span></span><br><span class="line">	name1 := name[:<span class="number">4</span>]</span><br><span class="line">	fmt.Println(name,name1)</span><br><span class="line">    <span class="comment">// name 和 name1 都不会改变</span></span><br><span class="line">	name = <span class="string">&quot;hhhhh&quot;</span></span><br><span class="line">	fmt.Println(name,name1) </span><br><span class="line">    name1 = <span class="string">&quot;233333&quot;</span></span><br><span class="line">	fmt.Println(name,name1)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建完全切片方法一：</span></span><br><span class="line">	<span class="comment">//numbers2 := numebrs[:]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建完全切片方法二：</span></span><br><span class="line">	numbers3 := []<span class="keyword">string</span>&#123;<span class="string">&quot;11&quot;</span>,<span class="string">&quot;40&quot;</span>,<span class="string">&quot;ann&quot;</span>,<span class="string">&quot;ccc&quot;</span>,<span class="string">&quot;bbbb&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//切片可以带有方法，纯数组不行</span></span><br><span class="line">	sort.StringSlice(numbers3).Sort()</span><br><span class="line">	fmt.Println(numbers3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>关于sort：<br>标准库sort包声明了一种StringSlice类型：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> StringSlice []<span class="keyword">string</span></span><br></pre></td></tr></table></figure>

<p>该类型还有关联的Sort方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p StringSlice)</span> <span class="title">Sort</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p>Go语言通过切片和append函数来实现动态数组的功能</p>
<p>切片长度：切片中可见元素的数量<br>切片容量：切片的底层数组决定了切片的容量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//切片的底层数组长度为5</span></span><br><span class="line">	<span class="comment">//切片长度为5,容量为5</span></span><br><span class="line">	vocabulary := []<span class="keyword">string</span>&#123;<span class="string">&quot;terminally&quot;</span>,<span class="string">&quot;visible&quot;</span>,<span class="string">&quot;lethal&quot;</span>,<span class="string">&quot;legally&quot;</span>,<span class="string">&quot;prescribe&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//此时，append函数将切片元素复制到新创建的数组里面并将新创建的数组作为切片的底层数组，该数组长度为原底层数组的两倍</span></span><br><span class="line">	<span class="comment">//切片长度为8,容量为10</span></span><br><span class="line">	vocabulary = <span class="built_in">append</span>(vocabulary,<span class="string">&quot;partnership&quot;</span>,<span class="string">&quot;compassion&quot;</span>,<span class="string">&quot;publication&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//三索引切片操作：</span></span><br><span class="line">	<span class="comment">//三索引操作旨在避免对底层数组的修改</span></span><br><span class="line">	arry_vocabulary := [...]<span class="keyword">string</span>&#123;<span class="string">&quot;candidness&quot;</span>,<span class="string">&quot;dose&quot;</span>,<span class="string">&quot;medication&quot;</span>,<span class="string">&quot;constitutionally&quot;</span>,<span class="string">&quot;uphold&quot;</span>,<span class="string">&quot;legislation&quot;</span>,&#125;</span><br><span class="line">	<span class="comment">//切片长度为4,容量为4</span></span><br><span class="line">	cut_vocabulary := arry_vocabulary[<span class="number">0</span>:<span class="number">4</span>:<span class="number">4</span>]</span><br><span class="line">	fmt.Println(cut_vocabulary)</span><br><span class="line">	cut_vocabulary = <span class="built_in">append</span>(cut_vocabulary,<span class="string">&quot;spark&quot;</span>)</span><br><span class="line">	fmt.Println(cut_vocabulary)</span><br><span class="line">	fmt.Println(arry_vocabulary)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//两索引</span></span><br><span class="line">	<span class="comment">//长度为2,容量为6（与底层数组相同），可以看到底层数组仍未被修改</span></span><br><span class="line">	cut_vocabulary2 := arry_vocabulary[<span class="number">0</span>:<span class="number">4</span>]</span><br><span class="line">	cut_vocabulary2 = <span class="built_in">append</span>(arry_vocabulary[:],<span class="string">&quot;notable&quot;</span>)</span><br><span class="line">	fmt.Println(cut_vocabulary2)</span><br><span class="line">	fmt.Println(arry_vocabulary)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//三索引但容量大于长度</span></span><br><span class="line">	cut_vocabulary3 := arry_vocabulary[<span class="number">0</span>:<span class="number">4</span>:<span class="number">5</span>]</span><br><span class="line">	cut_vocabulary3 = <span class="built_in">append</span>(cut_vocabulary,<span class="string">&quot;spark&quot;</span>)</span><br><span class="line">	fmt.Println(cut_vocabulary3)</span><br><span class="line">	fmt.Println(arry_vocabulary)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用make函数对切片容量实行预分配</span></span><br><span class="line">	<span class="comment">//切片长度为0,容量为10</span></span><br><span class="line">	test_cut1 := <span class="built_in">make</span>([]<span class="keyword">string</span>,<span class="number">0</span>,<span class="number">10</span>)</span><br><span class="line">	test_cut1 = <span class="built_in">append</span>(test_cut1,<span class="string">&quot;hhhhhhhhhhhhhh&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//切片长度为10,容量为10,元素默认为零值</span></span><br><span class="line">	test_cut2 := <span class="built_in">make</span>([]<span class="keyword">string</span>,<span class="number">10</span>)</span><br><span class="line">	<span class="comment">//此时将向切片中追加第11个元素</span></span><br><span class="line">	test_cut2 = <span class="built_in">append</span>(test_cut2,<span class="string">&quot;hhhhhhhhh&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h2><p>映射（map）：可将键映射到值<br>与数组和切片使用序列整数作为索引不同的是，映射的键几乎可以是任何类型</p>
<p>可以理解为Python中的字典</p>
<p>Go语言必须为映射的键和值指定类型<br>格式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">map</span>[键的类型]值的类型</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//声明map方法一：</span></span><br><span class="line">	map1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">		<span class="string">&quot;key1&quot;</span>:<span class="number">1</span>,</span><br><span class="line">		<span class="string">&quot;key2&quot;</span>:<span class="number">2</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//声明map方法二</span></span><br><span class="line">	map2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line">	map2[<span class="string">&quot;New_York&quot;</span>] = <span class="number">1</span></span><br><span class="line">	map2[<span class="string">&quot;San_Franscisco&quot;</span>] = <span class="number">2</span></span><br><span class="line">	map2[<span class="string">&quot;Tokyo&quot;</span>] = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//数组或一些基本类型在赋值给新变量或传递至函数/方法时都会创建相应的副本，但映射不会</span></span><br><span class="line">	map3 := map1</span><br><span class="line">	map3[<span class="string">&quot;key1&quot;</span>]=<span class="number">2</span></span><br><span class="line">	fmt.Println(map3)</span><br><span class="line">	fmt.Println(map1)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//遍历映射</span></span><br><span class="line">	<span class="comment">//遍历键</span></span><br><span class="line">	<span class="keyword">for</span> key := <span class="keyword">range</span> map2&#123;</span><br><span class="line">		fmt.Print(key)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Print(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//遍历值</span></span><br><span class="line">	<span class="keyword">for</span> _,value := <span class="keyword">range</span> map2&#123;</span><br><span class="line">		fmt.Print(value)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Print(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//遍历键值</span></span><br><span class="line">	<span class="keyword">for</span> key,value := <span class="keyword">range</span> map2&#123;</span><br><span class="line">		fmt.Println(key,value)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//删除键值对</span></span><br><span class="line">	<span class="comment">//delete(map_name,key_name)</span></span><br><span class="line">	<span class="built_in">delete</span>(map2,<span class="string">&quot;New_York&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断某一个键值对是否存在</span></span><br><span class="line">	<span class="comment">//当键值对不存在，输出对应数据类型的零值</span></span><br><span class="line">	fmt.Println(map2[<span class="string">&quot;New_York&quot;</span>])</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用value, ok := map[key]的写法判断</span></span><br><span class="line">	map2[<span class="string">&quot;Shenzheng&quot;</span>] = <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> value,ok := map2[<span class="string">&quot;Shenzheng&quot;</span>]; ok&#123;</span><br><span class="line">		fmt.Println(value,<span class="string">&quot; is exited.&quot;</span>)</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;not exited&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="状态与行为"><a href="#状态与行为" class="headerlink" title="状态与行为"></a>状态与行为</h1><p>状态：可以是值或结构package main<br>行为：函数和方法</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>基本用法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义结构</span></span><br><span class="line"><span class="keyword">type</span> city <span class="keyword">struct</span>&#123;</span><br><span class="line">	country,name <span class="keyword">string</span></span><br><span class="line">	rank <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义结构</span></span><br><span class="line"><span class="keyword">type</span> city <span class="keyword">struct</span>&#123;</span><br><span class="line">	country,name <span class="keyword">string</span></span><br><span class="line">	rank <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//声明方法一：</span></span><br><span class="line">	<span class="keyword">var</span> newYork city</span><br><span class="line">	newYork.rank = <span class="number">1</span></span><br><span class="line">	newYork.name = <span class="string">&quot;New York&quot;</span></span><br><span class="line">	newYork.country = <span class="string">&quot;American&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//声明方法二：</span></span><br><span class="line">	<span class="keyword">var</span> tokyo = city&#123;country:<span class="string">&quot;Japan&quot;</span>,rank:<span class="number">2</span>&#125;</span><br><span class="line">	<span class="comment">//未给定字段则自动声明为对应的零值</span></span><br><span class="line">	fmt.Println(tokyo.name)</span><br><span class="line">	tokyo.name = <span class="string">&quot;Tokyo&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//结构复制</span></span><br><span class="line">	<span class="comment">//两个结构变化不会对彼此有任何影响</span></span><br><span class="line">	anotherTokyo := tokyo</span><br><span class="line">	anotherTokyo.rank = <span class="number">3</span></span><br><span class="line">	fmt.Println(anotherTokyo,<span class="string">&quot;\n&quot;</span>,tokyo)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//由结构组成的切片</span></span><br><span class="line">	cities := []city&#123;newYork,tokyo&#125;</span><br><span class="line">	fmt.Println(cities)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//临时使用的匿名结构</span></span><br><span class="line">	hhhh := <span class="keyword">struct</span> &#123;</span><br><span class="line">		ccc <span class="keyword">int</span></span><br><span class="line">		ddd <span class="keyword">string</span></span><br><span class="line">	&#125;&#123;<span class="number">2333333</span>,<span class="string">&quot;2333333333&quot;</span>&#125;</span><br><span class="line">	fmt.Println(hhhh)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Go面向对象"><a href="#Go面向对象" class="headerlink" title="Go面向对象"></a>Go面向对象</h2><p>Go没有类，而是通过结构与方法的结合实现面向对象</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> literallyPopulation <span class="keyword">struct</span> &#123;</span><br><span class="line">	literalRate <span class="keyword">float64</span></span><br><span class="line">	totalPopulation <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> country <span class="keyword">struct</span> &#123;</span><br><span class="line">	countryName <span class="keyword">string</span></span><br><span class="line">	<span class="comment">//运用组合</span></span><br><span class="line">	theLiterallyPopulation literallyPopulation</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newCountry</span><span class="params">(countryName <span class="keyword">string</span>, literalRate <span class="keyword">float64</span>,totalPopulation <span class="keyword">int</span>)</span> <span class="params">(c country)</span></span>&#123;</span><br><span class="line">	l := literallyPopulation&#123;literalRate:literalRate,totalPopulation:totalPopulation&#125;</span><br><span class="line">	c = country&#123;countryName:countryName,theLiterallyPopulation: l&#125;</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(theLiteralPopulation literallyPopulation)</span> <span class="title">countLiteralPopulation</span><span class="params">()</span> <span class="params">(<span class="keyword">float64</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> theLiteralPopulation.literalRate*<span class="keyword">float64</span>(theLiteralPopulation.totalPopulation)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//转发</span></span><br><span class="line"><span class="comment">//手动转发</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c country)</span> <span class="title">countLiteralPopulation</span><span class="params">()</span> <span class="title">float64</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> c.theLiterallyPopulation.literalRate*<span class="keyword">float64</span>(c.theLiterallyPopulation.totalPopulation)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">c := newCountry(<span class="string">&quot;hhhh&quot;</span>,<span class="number">0.34</span>,<span class="number">10000</span>)</span><br><span class="line">lp := c.countLiteralPopulation()</span><br><span class="line">fmt.Println(lp)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现自动转发：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//我代码呢？</span></span><br></pre></td></tr></table></figure>

<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>用于实现多态</p>
<p>接口是一种类型，是一组method的集合<br>接口命名一般以-er结尾</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> shower <span class="keyword">interface</span> &#123;</span><br><span class="line">	showName() <span class="keyword">string</span></span><br><span class="line">	showRank() <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> sayer <span class="keyword">interface</span> &#123;</span><br><span class="line">	sayCharacteristic() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接口嵌套</span></span><br><span class="line"><span class="keyword">type</span> sayAndShower <span class="keyword">interface</span> &#123;</span><br><span class="line">	sayer</span><br><span class="line">	shower</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> city <span class="keyword">struct</span> &#123;</span><br><span class="line">	name           <span class="keyword">string</span></span><br><span class="line">	rank           <span class="keyword">int</span></span><br><span class="line">	characteristic <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> country <span class="keyword">struct</span> &#123;</span><br><span class="line">	name           <span class="keyword">string</span></span><br><span class="line">	rank           <span class="keyword">int</span></span><br><span class="line">	characteristic <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(city city)</span> <span class="title">showName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> city.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(city city)</span> <span class="title">showRank</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> city.rank</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(city city)</span> <span class="title">sayCharacteristic</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> city.characteristic</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(country country)</span> <span class="title">showName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> country.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(country country)</span> <span class="title">showRank</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> country.rank</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(country country)</span> <span class="title">sayCharacteristic</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> country.characteristic</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	structCity := city&#123;characteristic: <span class="string">&quot;very big&quot;</span>, rank: <span class="number">23333</span>, name: <span class="string">&quot;city of night&quot;</span>&#125;</span><br><span class="line">	structCountry := country&#123;characteristic: <span class="string">&quot;nb&quot;</span>, rank: <span class="number">100</span>, name: <span class="string">&quot;nbcountry&quot;</span>&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//指针类型</span></span><br><span class="line">	<span class="keyword">var</span> show shower</span><br><span class="line">	<span class="comment">//var say sayer</span></span><br><span class="line"></span><br><span class="line">	show = structCity</span><br><span class="line">	fmt.Println(show.showRank())</span><br><span class="line">	fmt.Println(show.showName())</span><br><span class="line"></span><br><span class="line">	show = structCountry</span><br><span class="line">	fmt.Println(show.showRank())</span><br><span class="line">	fmt.Println(show.showName())</span><br><span class="line"></span><br><span class="line">    say := structCity</span><br><span class="line">	fmt.Println(say.sayCharacteristic())</span><br><span class="line"></span><br><span class="line">	say = structCountry</span><br><span class="line">	fmt.Println(say.sayCharacteristic())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> showAndSay sayAndShower</span><br><span class="line">	showAndSay = structCountry</span><br><span class="line">	fmt.Println(showAndSay.showRank(), showAndSay.showName(), showAndSay.sayCharacteristic())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h1><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>几点需要注意的：</p>
<ul>
<li>对于指向结构的指针，Go中用.即可完成对方法和字段的访问，且解引用不是必须的</li>
<li>Go中数组与指针是两种独立的类型</li>
<li>对于指向数组的指针，Go语言提供了自动解引用的特性，即解引用不是必须的</li>
<li>Go语言没有为切片和映射提供了自动解引用的特性</li>
<li>映射是一种隐式指针，所以是指针指向映射的举动往往是多此一举</li>
<li>切片实际上是指向数组的指针</li>
<li>指向切片的指针的作用是修改切片本身，包括切片的长度，容量和起始偏移量</li>
<li>方法的接收者和函数形参在处理指针方面十分类似，都可以实现对原有字段的改变</li>
<li>关于指针和接口：指针接收者能仅能接收指针变量，而值接收者可接受指针或非指针变量</li>
</ul>
<h2 id="nil"><a href="#nil" class="headerlink" title="nil"></a>nil</h2><p>nil是指针，切片，映射和接口的零值<br>解引用nil指针将引发恐慌（panic）</p>
<ul>
<li>nil与方法：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">	score <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *person)</span> <span class="title">getScore</span><span class="params">()</span></span> &#123;</span><br><span class="line">	p.score++ <span class="comment">//此处发生了解引用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> p *person</span><br><span class="line">	p.getScore() <span class="comment">//解引用nil指针，引发恐慌</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>nil与函数：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn <span class="function"><span class="keyword">func</span><span class="params">(a,b <span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br><span class="line">fn(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">//解引用nil指针引发惊恐</span></span><br></pre></td></tr></table></figure>
<ul>
<li>nil与切片：<br>不包含任何元素的空切片和nil切片并不相等，但通常可以替换使用</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> slice []<span class="keyword">int</span> <span class="comment">//值为nil的切片</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//关键字range，len()和append()等可以正常处理nil切片</span></span><br><span class="line">	<span class="keyword">for</span> _, ingredient := <span class="keyword">range</span> slice &#123;</span><br><span class="line">		fmt.Println(ingredient) <span class="comment">//不会包含任何输出</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(slice))</span><br><span class="line"></span><br><span class="line">	slice = <span class="built_in">append</span>(slice, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">	<span class="comment">//关键字range，len()和append()等可以正常处理nil切片</span></span><br><span class="line">	<span class="keyword">for</span> _, ingredient := <span class="keyword">range</span> slice &#123;</span><br><span class="line">		fmt.Println(ingredient) <span class="comment">//不会包含任何输出</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(slice))</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//不包含任何元素的空切片和nil切片替换使用</span></span><br><span class="line">	slice = <span class="built_in">append</span>(slice, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nil与映射<br>映射在声明之后若没有使用复合字面量或内置make函数初始化，则其值为默认的nil。<br>可以对值为nil的map进行读取操作，但不可进行写入操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> map1 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//进行读取操作</span></span><br><span class="line">	value, ok := map1[<span class="string">&quot;hhhh&quot;</span>]</span><br><span class="line">	<span class="keyword">if</span> ok &#123;</span><br><span class="line">		fmt.Println(value)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> key, value := <span class="keyword">range</span> map1 &#123;</span><br><span class="line">		fmt.Println(key, value)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nil与接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//空接口妙用之一:以空接口作为函数行参，可以向函数传递任何类型的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span>&#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Type:%T Value:%v \n&quot;</span>,x,x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//空接口可以储存任意类型的值</span></span><br><span class="line">	<span class="comment">//定义一个空接口的值</span></span><br><span class="line">	<span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	i:= <span class="number">100</span></span><br><span class="line">	j:= <span class="string">&quot;hhhhhh&quot;</span></span><br><span class="line">	k:= <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	x = i</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Type:%T Value:%v \n&quot;</span>,x,x)</span><br><span class="line"></span><br><span class="line">	x=j</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Type:%T Value:%v \n&quot;</span>,x,x)</span><br><span class="line"></span><br><span class="line">	x=k</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Type:%T Value:%v \n&quot;</span>,x,x)</span><br><span class="line"></span><br><span class="line">	show(i)</span><br><span class="line">	show(j)</span><br><span class="line">	show(k)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//空接口妙用之二：使用空接口实现保存任何值的特点</span></span><br><span class="line">	<span class="keyword">var</span> stuInfo = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	</span><br><span class="line">	stuInfo[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;bai&quot;</span></span><br><span class="line">	stuInfo[<span class="string">&quot;age&quot;</span>] = <span class="number">12</span></span><br><span class="line">	stuInfo[<span class="string">&quot;sex&quot;</span>] = <span class="string">&quot;nan&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h1><h2 id="扫一下盲"><a href="#扫一下盲" class="headerlink" title="扫一下盲"></a>扫一下盲</h2><p>Go中，独立运行的任务谓之goroutine<br>goroutine之间的通信依赖通道<br>通道(channel)是一种类型</p>
<blockquote>
<p> A.进程是程序在操作系统中的一次执行过程，系统进行资源分配和调度的一个独立单位。<br> B. 线程是进程的一个执行实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位。<br> C.一个进程可以创建和撤销多个线程;同一个进程中的多个线程之间可以并发执行。</p>
</blockquote>
<p>并发：多线程程序在一个核的cpu上运行<br>并行：多线程程序在多个核的cpu上运行</p>
<p>协程：比线程更轻量级的存在，一个线程可拥有多个协程。协程不是被操作系统内核所管理的，而是完全由程序所控制，也就是在用户态执行。这样带来的好处是性能大幅度的提升，因为不会像线程切换那样消耗资源。（线程是由操作系统内核管理的）</p>
<p>协程可以理解为一个特殊的函数</p>
<p>一个线程的多个协程的运行是串行的。当一个协程运行时，其它协程必须挂起。</p>
<blockquote>
<p>上下文切换</p>
<ul>
<li>进程的切换者是操作系统，切换时机是根据操作系统自己的切换策略，用户是无感知的。进程的切换内容包括页全局目录、内核栈、硬件上下文，切换内容保存在内存中。进程切换过程是由“用户态到内核态到用户态”的方式，切换效率低。</li>
<li>线程的切换者是操作系统，切换时机是根据操作系统自己的切换策略，用户无感知。线程的切换内容包括内核栈和硬件上下文。线程切换内容保存在内核栈中。线程切换过程是由“用户态到内核态到用户态”， 切换效率中等。</li>
<li>协程的切换者是用户（编程者或应用程序），切换时机是用户自己的程序所决定的。协程的切换内容是硬件上下文，切换内存保存在用户自己的变量（用户栈或堆）中。协程的切换过程只有用户态，即没有陷入内核态，因此切换效率高。</li>
</ul>
</blockquote>
<p>python两种并发：1，多线程和多进程来进行并发；2，使用协程进程并发</p>
<p>python大部分库基于前一种并发方式，而go则完全基于后一种来开发</p>
<h2 id="sync-WaitGroup"><a href="#sync-WaitGroup" class="headerlink" title="sync.WaitGroup"></a>sync.WaitGroup</h2><table>
<thead>
<tr>
<th>方法名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>(wg * WaitGroup) Add(delta int)</td>
<td>计数器+delta</td>
</tr>
<tr>
<td>(wg *WaitGroup) Done()</td>
<td>计数器-1</td>
</tr>
<tr>
<td>(wg *WaitGroup) Wait()</td>
<td>阻塞直到计数器变为0</td>
</tr>
</tbody></table>
<p>例如当我们启动了N 个并发任务时，就将计数器值增加N。每个任务完成时通过调用Done()方法将计数器减1。通过调用Wait()来等待并发任务执行完，当计数器值为0时，表示所有并发任务已经完成。</p>
<h2 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sleepyGopher</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	fmt.Println(i, <span class="string">&quot;awake&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="comment">//使用go关键字启动一个线程</span></span><br><span class="line">		<span class="keyword">go</span> sleepyGopher(i)</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//因为main函数本身也是一个协程，而主协程一旦结束，则其它的协程也会结束</span></span><br><span class="line">    <span class="comment">//所以需要sync.WaitGroup来实现并发任务的同步</span></span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用互斥锁同步协程"><a href="#使用互斥锁同步协程" class="headerlink" title="使用互斥锁同步协程"></a>使用互斥锁同步协程</h2><ul>
<li>并发要面临资源竞争问题</li>
</ul>
<p>最后得到的结果与预期不相符</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">        x = x + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">go</span> add()</span><br><span class="line">    <span class="keyword">go</span> add()</span><br><span class="line">    wg.Wait()</span><br><span class="line">    fmt.Println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此时引入互斥锁解决数据同步的问题</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">		lock.Lock()</span><br><span class="line">		x = x + <span class="number">1</span></span><br><span class="line">		lock.Unlock()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sub</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">		<span class="comment">//互相竞争资源的步骤必须使用同一把锁</span></span><br><span class="line">		lock.Lock()</span><br><span class="line">		x = x - <span class="number">1</span></span><br><span class="line">		lock.Unlock()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">go</span> add()</span><br><span class="line">	<span class="keyword">go</span> sub()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>能不用锁就不用锁，因为开锁解锁消耗时间，影响性能</p>
<h2 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h2><p>对于绝大多数web系统，读多写少</p>
<p>我们必须要在读和写上加锁，但当读的操作很多时，一个读的操作上锁对其它读的操作影响不容小觑。</p>
<p>例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">	fmt.Println(<span class="string">&quot;读&quot;</span>)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;读毕&quot;</span>)</span><br><span class="line">	lock.UnLock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span> ; i++&#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> read()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，我们需要一把读之间不会相互竞争，而读写之间会相互竞争的锁。</p>
<p>引入读写锁。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.RWMutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.RLock()</span><br><span class="line">	fmt.Println(<span class="string">&quot;读&quot;</span>)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;读毕&quot;</span>)</span><br><span class="line">	lock.RUnlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">	fmt.Println(<span class="string">&quot;写&quot;</span>)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">10</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;写毕&quot;</span>)</span><br><span class="line">	lock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> read()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> write()</span><br><span class="line"></span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="协程间的通信机制"><a href="#协程间的通信机制" class="headerlink" title="协程间的通信机制"></a>协程间的通信机制</h2><p>channel提供了一种定向通信机制(python和java常用消息队列实现)</p>
<p>分类：有无缓冲；双向还是单向</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(data <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">	<span class="comment">//第一种取法</span></span><br><span class="line">	<span class="comment">/*	msg,ok := &lt;- data</span></span><br><span class="line"><span class="comment">		if(ok)&#123;</span></span><br><span class="line"><span class="comment">			fmt.Println(msg)</span></span><br><span class="line"><span class="comment">		&#125;*/</span></span><br><span class="line">	<span class="comment">//使用 for range 来取：</span></span><br><span class="line">	<span class="keyword">for</span> msg := <span class="keyword">range</span> data &#123;</span><br><span class="line">		fmt.Println(msg)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	lock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//定义时必须指定类型</span></span><br><span class="line">	<span class="comment">//channel为引用类型，默认为nil</span></span><br><span class="line">	<span class="keyword">var</span> msg <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">	<span class="comment">//使用make初始化的有三种：chan map slice</span></span><br><span class="line">	<span class="comment">//若缓冲空间满了还往其中放值会引发错误</span></span><br><span class="line">	<span class="comment">//msg = make(chan int)    //这种存储方式无缓冲</span></span><br><span class="line">	msg = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>) <span class="comment">//第二种存储方式：有缓冲；第二个参数指定缓冲空间</span></span><br><span class="line">	msg &lt;- <span class="number">1</span></span><br><span class="line">	<span class="comment">//利用一个协程来腾空缓冲空间</span></span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> consumer(msg)</span><br><span class="line">	msg &lt;- <span class="number">2</span></span><br><span class="line">	<span class="comment">//fmt.Println(data)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//关闭通道 1,关闭的channel不能再向其中发送数据 2，消费者可继续消费数据，直到数据被消费完</span></span><br><span class="line">	<span class="built_in">close</span>(msg)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>无缓冲通道的使用</li>
</ul>
<p>对于一个无缓冲的channel，在启动一个消费者之前放数据就会报错</p>
<p>在放一个数据到channel中时，会阻塞数据，阻塞之前会放一把锁；只有当取值时，这把锁才会解开</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(data <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">    <span class="comment">//当通道未关闭时，ok返回true，否则，返回false</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		msg, ok := &lt;-data</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(msg)</span><br><span class="line">	&#125;</span><br><span class="line">	lock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> msg <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	msg = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用无缓冲通道时，在向管道发送信息之前，另一端必须要有消费者</span></span><br><span class="line">	<span class="keyword">go</span> consumer(msg)</span><br><span class="line">	msg &lt;- <span class="number">1</span></span><br><span class="line">	msg &lt;- <span class="number">3</span></span><br><span class="line">	<span class="built_in">close</span>(msg)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="双向和单向的channel"><a href="#双向和单向的channel" class="headerlink" title="双向和单向的channel"></a>双向和单向的channel</h2><p>能使用单向channel就尽量使用单向channel</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="comment">//只能从中取值，不能从中放值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(data &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	lock.Lock()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		msg, ok := &lt;-data</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(msg)</span><br><span class="line">	&#125;</span><br><span class="line">	lock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个只能往其中放值，不能从中取值的channel</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(data <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		data &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> msg <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	msg = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用无缓冲通道时，在向管道发送信息之前，另一端必须要有消费者</span></span><br><span class="line">	<span class="comment">//普通的channel可直接转换为单向的channel，反之则不行</span></span><br><span class="line">	<span class="keyword">go</span> consumer(msg)</span><br><span class="line">	<span class="keyword">go</span> producer(msg)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">close</span>(msg)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><p>select作用域通讯场景，伪随机选择一组可能的send和receive操作去执行。</p>
<p>考虑有多个case等待处理的情况，比如同时有多个channnel可以接收数据，那么select会伪随机选择一个case去处理；若无case需要处理，那么select会选择default取处理；如果没有default，那么select会阻塞，直到某个case需要处理。</p>
<p>select应用场景：</p>
<ul>
<li>timeout超时机制</li>
<li>判断channel是否被阻塞</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//timeout超时机制</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> msg <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	msg = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">		msg &lt;- <span class="number">1</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> res := &lt;-msg:</span><br><span class="line">		fmt.Println(res)</span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(time.Second):</span><br><span class="line">		fmt.Println(<span class="string">&quot;timeout 1&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(msg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断channel是否被阻塞</span></span><br><span class="line"><span class="comment">//若所有的channel都被阻塞了，那么就会执行default</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	msg1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line">	msg2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">		msg1 &lt;- <span class="number">1</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">		msg2 &lt;- <span class="number">1</span></span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> res := &lt;-msg1:</span><br><span class="line">		fmt.Println(res)</span><br><span class="line">	<span class="keyword">case</span> res := &lt;-msg2:</span><br><span class="line">		fmt.Println(res)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(msg1)</span><br><span class="line">	<span class="built_in">close</span>(msg2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>场景：</p>
<p>假设在有一个goroutine，希望它在一定时间内监控cpu信息，之后退出</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stop <span class="keyword">chan</span> <span class="keyword">bool</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cpuInfo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-stop:</span><br><span class="line">			fmt.Println(<span class="string">&quot;monitor closes&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">			fmt.Println(<span class="string">&quot;monitor is running&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> cpuInfo()</span><br><span class="line">	time.Sleep(<span class="number">6</span> * time.Second)</span><br><span class="line">	stop &lt;- <span class="literal">true</span></span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(<span class="string">&quot;goroutine finishes&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="context"><a href="#context" class="headerlink" title="context"></a>context</h2><p>考虑更复杂的场景，若有多个监控协程在运行，还想用上面的select加channel的方式来指定时间退出的操作，我们就需要向管道中传多个值。</p>
<p>这时引入context：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cpuInfo</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="comment">//检验context是否cancel</span></span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">			fmt.Println(<span class="string">&quot;cpu monitor finishes&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">			fmt.Println(<span class="string">&quot;cpu monitor is running&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">memoryInfo</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="comment">//若父context cancel，则子context也会cancel</span></span><br><span class="line">	ctx2, _ := context.WithCancel(ctx)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx2.Done():</span><br><span class="line">			fmt.Println(<span class="string">&quot;memory monitor finishes&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">			fmt.Println(<span class="string">&quot;memory monitor is running&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indicatorInfo</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">			fmt.Println(<span class="string">&quot;indicator monitor finishes&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			time.Sleep(time.Second)</span><br><span class="line">			fmt.Println(<span class="string">&quot;indicator monitor is running&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line"></span><br><span class="line">	wg.Add(<span class="number">3</span>)</span><br><span class="line">	<span class="keyword">go</span> cpuInfo(ctx)</span><br><span class="line">	<span class="keyword">go</span> memoryInfo(ctx)</span><br><span class="line">	<span class="keyword">go</span> indicatorInfo(ctx)</span><br><span class="line">	time.Sleep(<span class="number">6</span> * time.Second)</span><br><span class="line">	cancel()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(<span class="string">&quot;all monitors finish&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>几种context：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">context.WithCancel() <span class="comment">//可取消，手动cancel</span></span><br><span class="line">context.WithDeadline() <span class="comment">//可取消，在某一个时间点之前取消，也可手动取消</span></span><br><span class="line">context.WithTimeout() <span class="comment">//可取消，设置超时间，也可在timeout之前手动取消</span></span><br></pre></td></tr></table></figure>

<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><h2 id="随便说说"><a href="#随便说说" class="headerlink" title="随便说说"></a>随便说说</h2><ul>
<li>go异常处理思想：<br>若一个函数可能出现异常，那么就应把异常作为返回值，没有异常就返回nil</li>
</ul>
<p>关于defer</p>
<ul>
<li><p>defer之后只能是函数调用，不能是表达式</p>
</li>
<li><p>若有多个defer，则会创建一个defer栈，后注册的defer先执行</p>
</li>
<li><p>向defer中传递的函数是值，不是引用；压入的不仅是函数，还有参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出hhhh</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;hhhh&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f()</span><br><span class="line">	f = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;23333&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出1</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">1</span></span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">(a <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">		fmt.Println(a)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f(x)</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出2</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">1</span></span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">(a *<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">		fmt.Println(a)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f(&amp;x)</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出2，这是由于闭包的特性</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">1</span></span><br><span class="line">    <span class="comment">//使用的是全局的值，上面几个例子优先使用局部变量</span></span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(x)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f()</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出1，优先使用局部变量</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">1</span></span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">		fmt.Println(x)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f(x)</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="panic和recover"><a href="#panic和recover" class="headerlink" title="panic和recover"></a>panic和recover</h2><p>错误和异常概念区分：</p>
<ul>
<li><p>错误：错误你可以预判</p>
</li>
<li><p>异常：不可预判，往往是由于代码不严谨</p>
</li>
</ul>
<p>错误：</p>
<p>错误的场景：</p>
<ul>
<li>文件IO</li>
<li>数据库连接</li>
<li>空指针引用</li>
<li>下标越界</li>
<li>锁</li>
<li>…</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对于可能出现错误的地方要提取预知</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;hhhhh&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="number">1</span></span><br><span class="line">	b := <span class="number">0</span></span><br><span class="line">	r, err := f(a, b)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抛出异常和捕捉异常：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对于可能出现错误的地方要提取预知</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> b == <span class="number">0</span>&#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;hhhhh&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> a / b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="number">1</span></span><br><span class="line">	b := <span class="number">0</span></span><br><span class="line">	<span class="comment">//recover必须执行</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		err := <span class="built_in">recover</span>()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="comment">//这样无效</span></span><br><span class="line">	<span class="comment">//defer recover()</span></span><br><span class="line">	fmt.Println(f(a, b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在任一子协程中使用panic抛出错误会导致主协程挂掉，同时导致其它的协程挂掉</p>
</li>
<li><p>在一个协程中再开一个协程，父协程捕获不到子协程抛出的异常，所以会出现上述问题</p>
</li>
<li><p>一种处理方法：单独写一个函数用于捕获异常，每开一个协程就defer这个函数</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/25/python-mongodb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/25/python-mongodb/" class="post-title-link" itemprop="url">python-mongodb</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-09-25 20:53:37 / Modified: 21:46:16" itemprop="dateCreated datePublished" datetime="2021-09-25T20:53:37+08:00">2021-09-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMongo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.__client = MongoClient(host=<span class="string">&quot;127.0.0.1&quot;</span>,port=<span class="number">27017</span>)</span><br><span class="line">        self.collection = self.__client[<span class="string">&#x27;test&#x27;</span>][<span class="string">&quot;t1&quot;</span>] <span class="comment">#使用方括号选择数据库和集合</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        self.__client.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_insert</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment">#insert接收字典，返回ObjectID</span></span><br><span class="line">        ret = self.collection.insert(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lily&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">17</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_insert_many</span>(<span class="params">self</span>):</span></span><br><span class="line">        item_list = [&#123;<span class="string">&quot;name&quot;</span>:<span class="string">f&quot;test<span class="subst">&#123;i&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)&#125;]</span><br><span class="line">        <span class="comment">#isnert_many接收列表，列表中为需要插入的字典</span></span><br><span class="line">        ret_list = self.collection.insert_many(item_list)</span><br><span class="line">        <span class="comment">#ret_list.inserted_ids为一个列表，包括所有插入数据的id</span></span><br><span class="line">        <span class="keyword">return</span> ret_list.inserted_ids</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">try_find_one</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment">#find_one返回一个结果，接收一个字典形式的字典</span></span><br><span class="line">        t = self.collection.find_one(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;test5&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">try_find_many</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment">#返回所有结果，若条件为空，返回所有数据</span></span><br><span class="line">        t = self.collection.find()</span><br><span class="line">        <span class="comment">#返回一个Cursor游标</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> t:</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> t:</span><br><span class="line">            <span class="built_in">print</span>(j) <span class="comment">#由于上面游标已经移到最后一个，不会再有输出</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">list</span>(t)) <span class="comment">#可以强转</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">try_update_one</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.collection.update_one(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;test5&quot;</span>&#125;,&#123;<span class="string">&quot;$set&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;new_test5&quot;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">try_update_many</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.collection.update_many(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test5&quot;</span>&#125;, &#123;<span class="string">&quot;$set&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;new_test5&quot;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">try_delete_one</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.collection.delete_one(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;test5&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">try_delete_many</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.collection.delete_many(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;test5&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/25/mongodb%E5%AD%A6%E4%B9%A0%EF%BC%881%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/25/mongodb%E5%AD%A6%E4%B9%A0%EF%BC%881%EF%BC%89/" class="post-title-link" itemprop="url">mongodb学习（1）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-09-25 14:39:19 / Modified: 20:52:36" itemprop="dateCreated datePublished" datetime="2021-09-25T14:39:19+08:00">2021-09-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h1><p>“non-relational”或”Not Only SQL”</p>
<p>非关系数据库。数据与数据之间不再有一对一或一对多之类的对应的关系，数据从一个个清晰的条目（如MySQL）变成了一个独立的个体。</p>
<p>MySQL扩展性差，大数据下IO困难，表结构更改困难。MongoDB易扩展，大数据高性能，灵活的数据模型，高可用。</p>
<ul>
<li><p>易扩展：数据之间无关系，所以易扩展</p>
</li>
<li><p>大数据量，高性能：读写性能高，得益于其数据库结构简单</p>
</li>
<li><p>数据模型灵活：无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系型数据库中，增删字段十分麻烦。</p>
</li>
<li><p>缺点：存储空间开销大</p>
</li>
</ul>
<h1 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db //查看当前数据库</span><br><span class="line">show dbs //查看所有数据库</span><br><span class="line">use db_name //切换数据库</span><br><span class="line">db.dropDatabase() //删除当前数据库</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">创建数据库：</span><br><span class="line">use db_name</span><br><span class="line">插入数据操作</span><br><span class="line"></span><br><span class="line">不手动创建集合：</span><br><span class="line">想不存在的集合第一次插入数据时，集合会被创建出来</span><br><span class="line">手动创建集合：</span><br><span class="line">db.createConnection(name,options)</span><br><span class="line">db.createCollection(&quot;sub&quot;,&#123;capped:true,size:10&#125;)</span><br><span class="line"></span><br><span class="line">show collections</span><br><span class="line">db.col_name.drop()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建日期：</span><br><span class="line">new Data(&#x27;2021-09-25&#x27;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.col_name.insert(&#123;key1:value1,key2:value2&#125;)</span><br><span class="line">db.col_name.find() //展示col中所有数据</span><br><span class="line">db.col_name.save(document) //insert插入不会将原有相同_ID相同的数据修改，而save会</span><br><span class="line">db.update(&lt;query&gt;,&lt;update&gt;,&#123;multi:&lt;boolean&gt;&#125;) //三个参数：更新条件，更新操作，默认false，表示只更新第一条，true则更新所有</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//已有数据&#123;&quot;_id&quot;:1,&quot;name&quot;:&quot;joker&quot;,&quot;age&quot;:19&#125;</span><br><span class="line">db.col_name.update(&#123;&quot;_id&quot;,1&#125;,&#123;&quot;name&quot;:&quot;joke&quot;&#125;) //此时数据变为&#123;&quot;_id&quot;:1,&quot;name&quot;:&quot;joke&quot;&#125;</span><br><span class="line">db.col_name.update(&#123;&quot;_id&quot;:1&#125;,&#123;$set:&#123;name:&quot;joke&quot;&#125;&#125;) //此时数据变为&#123;&quot;_id&quot;:1,&quot;name&quot;:&quot;joke&quot;,&quot;age&quot;:19&#125;</span><br><span class="line"></span><br><span class="line">//multi update only works with $ operator</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col_name.remove(&lt;query&gt;,&#123;justOne:&lt;boolean&gt;&#125;) //&lt;query&gt;为删除文档的条件（必选），justOne设为1或true，则只删除一条，默认false，表示删除多条</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.col_name.find(&#123;条件文档&#125;)</span><br><span class="line">db.col_name.findOne(&#123;条件文档&#125;)</span><br><span class="line">db.col_name.find().pretty() //将结果格式化</span><br></pre></td></tr></table></figure>

<p>比较运算符：</p>
<ul>
<li>等于：默认等于</li>
<li>小于 $lt （less than）</li>
<li>小于等于 $lte (less than equal)</li>
<li>大于 $gt (greater than)</li>
<li>大于等于 $gte</li>
<li>不等于 $ne</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col_name.find(&#123;age:&#123;$gte:18&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>范围运算符：</p>
<ul>
<li>$in $nin</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.stu.find(&#123;age:&#123;$in:[18,28,38]&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>逻辑运算符：</p>
<ul>
<li>and：,</li>
<li>or：$or</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.stu.find(&#123;$or:[&#123;age:&#123;$gte:16&#125;&#125;,&#123;hometown:&quot;hhh&quot;&#125;]&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//正则表达式：使用//或$regex</span><br><span class="line">db.products.find(&#123;sku:/^abc/&#125;)</span><br><span class="line">db.products.find(&#123;sku:&#123;$regex:&#x27;789$&#x27;&#125;&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col_name.find().limit(NUMBER).skip(NUMBER) //用于读取或跳过指定数量文档，可同时使用</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//自定义查询，使用&amp;where后面写一个函数，返回满足条件的数据</span><br><span class="line">db.stu.find(&#123;</span><br><span class="line">$where:function()&#123;</span><br><span class="line">retrun this.age&gt;30//this就是当前集合</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//投影：在查询返回的结果中，只显示必要的字段</span><br><span class="line">db.col_name.find(&#123;&#125;,&#123;字段名称:1,...&#125;) //1表示显示，0表示不显示，不能同时写1和0（_id除外）</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//排序</span><br><span class="line">db.col_name.find().sort(&#123;gender:-1&#125;) //参数1为升序，参数-1为降序 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//统计个数</span><br><span class="line">db.col_name.find(&#123;条件&#125;).count()</span><br><span class="line">db.col_name.count(&#123;条件&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//消除重复并返回不重复的结果</span><br><span class="line">db.col_name.distinct(&#x27;去重字段&#x27;,&#123;条件&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Object ID：文档ID</span><br><span class="line">String：字符串，有效的utf-8</span><br><span class="line">Boolean：true or false</span><br><span class="line">Integer：32位或64位</span><br><span class="line">Double：浮点值</span><br><span class="line">Arrays：数组/列表，多个值存储到一个键</span><br><span class="line">Object：一个值为一个文档，啥意思呢，一个字典中嵌套的另一个字典的意思吧</span><br><span class="line">Null：存储Null值</span><br><span class="line">Timestamp：unix时间戳</span><br><span class="line">Data：当前时间或日期的unix格式</span><br></pre></td></tr></table></figure>

<ul>
<li>每个文档都有一个属性，为_id，保证每个文档的唯一性</li>
<li>可以自行设计_id插入文档，若没有提供，那么mongodb为每个文档提供l一个独特的_id，类型为object ID</li>
<li>objectID是一个12字节十六进制数：前四个字节为当前时间戳，接下来三个字节为机器ID，接下来两个字节为Mongodb的服务进程ID，最后三个字节是增量值</li>
</ul>
<h1 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h1><p>聚合：基于数据处理的聚合管道，每个文档通过一个由多个阶段（stage）组成的管道，可以对每个阶段的管道进行分组、过滤等功能，然后经过一系列的处理，输出相应的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col_name.aggregate(&#123;管道:&#123;表达式&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>常用管道：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$group:将集合中的文档分组</span><br><span class="line">$match:过滤数据，只输出符合条件的文档</span><br><span class="line">$project:修改输入文档的结构，如重命名，增加，删除字段，创建计算结果</span><br><span class="line">$sort:将输入文档排序后输出</span><br><span class="line">$limit:限制聚合管道返回的文档数</span><br><span class="line">$skip:跳过指定数量文档，返回余下的文档</span><br><span class="line">$unwind:将数组类型的字段进行拆分</span><br></pre></td></tr></table></figure>

<p>常用表达式：</p>
<p>用于处理文档并输出，操作一般发生在管道之前</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：表达式:&#x27;$列名&#x27;</span><br><span class="line">$sum:计算总和</span><br><span class="line">$sum:1 表示以一倍计数</span><br><span class="line">$avg:计算平均值</span><br><span class="line">$min:获取最小值</span><br><span class="line">$max:获取最大值</span><br><span class="line">$push:在结果文档中插入值到一个数组中</span><br><span class="line">$first:根据资源文档的排序获取第一个文档的数据</span><br><span class="line">$last:根据资源文档的排序获取最后一个文档的数据</span><br></pre></td></tr></table></figure>

<h2 id="group"><a href="#group" class="headerlink" title="$group"></a>$group</h2><p>_id表示分组的依据，使用某个字段的格式为”$字段”</p>
<p>$group对应的字典中有几个键，结果就有几个</p>
<ul>
<li>统计男生、女生的总人数，并计算平均值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;$group:</span><br><span class="line">	&#123;</span><br><span class="line">		_id:&#x27;$gender&#x27;,</span><br><span class="line">		counter:&#123;$sum:1&#125;,</span><br><span class="line">		avg_age:&#123;$avg:&quot;$age&quot;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>求总人数，计算平均年龄</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;$group:</span><br><span class="line">	&#123;</span><br><span class="line">		_id:null,</span><br><span class="line">		counter:&#123;$sum:1&#125;,</span><br><span class="line">		avg_age:&#123;$avg:&quot;$age&quot;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>按多个条件进行分组</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">$group:</span><br><span class="line">&#123;</span><br><span class="line">_id:&#123;</span><br><span class="line">country:&#x27;$country&#x27;,</span><br><span class="line">city:&#x27;$city&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">$project:</span><br><span class="line">&#123;</span><br><span class="line">country:&#123;$_id.country&#125;,</span><br><span class="line">city:&#123;$_id.city&#125;,</span><br><span class="line">_id:0</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h2 id="project"><a href="#project" class="headerlink" title="$project"></a>$project</h2><ul>
<li>统计男生、女生的总人数，并计算平均值，并隐去_id</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;$group:</span><br><span class="line">	&#123;</span><br><span class="line">		_id:&#x27;$gender&#x27;,</span><br><span class="line">		counter:&#123;$sum:1&#125;,</span><br><span class="line">		avg_age:&#123;$avg:&quot;$age&quot;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">	&#123;</span><br><span class="line">	gender:&quot;$_id&quot;,</span><br><span class="line">	_id:0</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="match"><a href="#match" class="headerlink" title="$match"></a>$match</h2><p>match是管道命令，能将结果交给后一个管道，但是find不可以</p>
<ul>
<li>查询年龄大于20的学生</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">$macth:&#123;age:&#123;$gt:20&#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="sort"><a href="#sort" class="headerlink" title="$sort"></a>$sort</h2><ul>
<li>查询学生信息，按年龄进行排序</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b.stu.aggregate(&#123;$sort:&#123;age:1&#125;&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="limit"><a href="#limit" class="headerlink" title="$limit"></a>$limit</h2><ul>
<li>查询两名学生的信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate(&#123;$limit:2&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="skip"><a href="#skip" class="headerlink" title="$skip"></a>$skip</h2><ul>
<li>跳过两名学生的信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.stu.aggregate(&#123;$skip:2&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="unwind"><a href="#unwind" class="headerlink" title="$unwind"></a>$unwind</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">现有如下数据：</span><br><span class="line">&#123;_id:1,item:&quot;t-shirt&quot;,size:[&#x27;S&#x27;,&#x27;M&#x27;,&#x27;L&#x27;]&#125;</span><br><span class="line"></span><br><span class="line">db.col_name.aggregate(&#123;$unwind:&#x27;size&#x27;&#125;)</span><br><span class="line"></span><br><span class="line">结果:</span><br><span class="line">&#123;_id:1,item:&quot;t-shirt&quot;,size:&quot;S&quot;&#125;</span><br><span class="line">&#123;_id:1,item:&quot;t-shirt&quot;,size:&quot;M&quot;&#125;</span><br><span class="line">&#123;_id:1,item:&quot;t-shirt&quot;,size:&quot;L&quot;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>提高查询速度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">for(i=0;i&lt;100000;i++)&#123;db.col_name.insert(&#123;name:&#x27;test&#x27;+i,age;i&#125;)&#125;</span><br><span class="line"></span><br><span class="line">db.col_name.find(&#123;name:&#x27;test10000&#x27;&#125;).explain(&#x27;executionStats&#x27;) //explain(&#x27;executionStats&#x27;)会输出操作用时</span><br><span class="line">db.col_name.ensureIndex(&#123;属性:1&#125;) //1升序 -1降序</span><br><span class="line">db.col_name.ensureIndex(&#123;属性:1&#125;,&#123;&quot;unique&quot;:true&#125;) //建立唯一索引，被索引标记的值不可重复</span><br><span class="line">db.col_name.ensureIndex(&#123;属性1:1,属性2:1&#125;) //建立联合索引</span><br><span class="line">db.col_name.getIndexes() //查看索引</span><br><span class="line">db.col_name.dropIndex(索引名称) //删除索引</span><br></pre></td></tr></table></figure>

<h1 id="数据备份和恢复"><a href="#数据备份和恢复" class="headerlink" title="数据备份和恢复"></a>数据备份和恢复</h1><ul>
<li>备份</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mongodump -h dbhost -d dbname -o dbdirectory</span><br><span class="line">-h：数据所在服务器地址，可指定端口号</span><br><span class="line">-d：数据库名称</span><br><span class="line">-o：备份的数据存放的地址，此目录中放着备份出来的数据</span><br><span class="line"></span><br><span class="line">mongodump -h localhost -d test1 -o D:\mongodb_5.1</span><br></pre></td></tr></table></figure>

<ul>
<li>恢复</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mongorestore -h dbhost -d dbname --dir dbdirectory</span><br><span class="line">-h：同上</span><br><span class="line">-d：需要恢复的数据库实例</span><br><span class="line">--dir：备份数据所在位置</span><br><span class="line"></span><br><span class="line">mongorestore -h localhost -d test1 -o D:\mongodb_5.1</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="GuiYoung">
      <meta itemprop="description" content="十有九人堪白眼，百无一用是书生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Las Nubes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/" class="post-title-link" itemprop="url">数据结构之栈和队列</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-09-24 10:27:17 / Modified: 19:19:16" itemprop="dateCreated datePublished" datetime="2021-09-24T10:27:17+08:00">2021-09-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="栈的表示和实现"><a href="#栈的表示和实现" class="headerlink" title="栈的表示和实现"></a>栈的表示和实现</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;malloc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LIST_INIT_SIZE 5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LISTINCREMENT 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"></span><br><span class="line"><span class="comment">//typedef struct&#123;</span></span><br><span class="line"><span class="comment">//    char name[8];</span></span><br><span class="line"><span class="comment">//    int age;</span></span><br><span class="line"><span class="comment">//&#125;ElemType;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> ElemType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    ElemType *firstElem;</span><br><span class="line">    ElemType *lastElem;</span><br><span class="line">    <span class="keyword">int</span> stackSize;</span><br><span class="line">&#125;Stack;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">initStack</span><span class="params">(Stack &amp;s )</span></span>&#123;</span><br><span class="line">    s.firstElem = (ElemType*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (ElemType)*LIST_INIT_SIZE);</span><br><span class="line">    <span class="keyword">if</span>(!s.firstElem) <span class="keyword">return</span> ERROR;</span><br><span class="line">    s.lastElem = s.firstElem;</span><br><span class="line">    s.stackSize = LIST_INIT_SIZE;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">push</span><span class="params">(Stack &amp;s, ElemType e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s.stackSize+<span class="number">1</span>&gt;LIST_INIT_SIZE)&#123;</span><br><span class="line">        s.firstElem = (ElemType*) <span class="built_in">realloc</span>(s.firstElem,<span class="keyword">sizeof</span> (ElemType)*(s.stackSize+LISTINCREMENT));</span><br><span class="line">        <span class="keyword">if</span>(!s.firstElem) <span class="keyword">return</span> ERROR;</span><br><span class="line">        s.stackSize += LISTINCREMENT;</span><br><span class="line">    &#125;</span><br><span class="line">    *(s.lastElem) = e;</span><br><span class="line">    s.lastElem++;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">pop</span><span class="params">(Stack &amp;s, ElemType &amp;e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s.lastElem == s.firstElem)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    e = *(s.lastElem<span class="number">-1</span>);</span><br><span class="line">    s.lastElem--;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Stack s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(initStack(s)!=OK)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;init wrong&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">7</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(push(s,i)==OK) <span class="built_in">printf</span>(<span class="string">&quot;push Ok:%d&quot;</span>,i);</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;push wrong:%d&quot;</span>,i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ElemType e;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">7</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(pop(s,e)==OK) <span class="built_in">printf</span>(<span class="string">&quot;pop Ok:%d&quot;</span>,e);</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;pop error:%d&quot;</span>,i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="栈的应用"><a href="#栈的应用" class="headerlink" title="栈的应用"></a>栈的应用</h1><ul>
<li><p>10进制数N转换成8进制的算法</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">converse</span><span class="params">(<span class="keyword">int</span> N)</span></span>&#123;</span><br><span class="line">    Stack S;</span><br><span class="line">    initStack(S);</span><br><span class="line">    <span class="keyword">while</span> (N)&#123;</span><br><span class="line">        push(S,N%<span class="number">8</span>);</span><br><span class="line">        N /= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!isEmpty(S))&#123;</span><br><span class="line">        ElemType e;</span><br><span class="line">        push(S,e);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>括号匹配检验</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">isMatch</span><span class="params">(<span class="keyword">char</span> *<span class="built_in">string</span>)</span></span>&#123;</span><br><span class="line">    Stack s;</span><br><span class="line">    <span class="keyword">if</span>(!initStack(s)) <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    ElemType e;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">char</span> *p=<span class="built_in">string</span>;*p;p++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(*p == <span class="string">&#x27;(&#x27;</span> || *p == <span class="string">&#x27;&#123;&#x27;</span> || *p == <span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">            push(s,*p);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(*p == <span class="string">&#x27;)&#x27;</span> )&#123;</span><br><span class="line">            pop(s,e);</span><br><span class="line">            <span class="keyword">if</span>(e != <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> ERROR;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(*p == <span class="string">&#x27;]&#x27;</span> )&#123;</span><br><span class="line">            pop(s,e);</span><br><span class="line">            <span class="keyword">if</span>(e != <span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> ERROR;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(*p == <span class="string">&#x27;&#123;&#x27;</span> )&#123;</span><br><span class="line">            pop(s,e);</span><br><span class="line">            <span class="keyword">if</span>(e != <span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> ERROR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(isEmpty(s))</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    <span class="keyword">return</span> ERROR;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="链队列"><a href="#链队列" class="headerlink" title="链队列"></a>链队列</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;malloc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LIST_INIT_SIZE 5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LISTINCREMENT 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"></span><br><span class="line"><span class="comment">//typedef struct&#123;</span></span><br><span class="line"><span class="comment">//    char name[8];</span></span><br><span class="line"><span class="comment">//    int age;</span></span><br><span class="line"><span class="comment">//&#125;ElemType;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> ElemType;</span><br><span class="line"></span><br><span class="line"><span class="comment">//结点类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">QNode</span>&#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">QNode</span> * <span class="title">next</span>;</span></span><br><span class="line">&#125;QNode,*Queue;</span><br><span class="line"></span><br><span class="line"><span class="comment">//链队列类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    Queue frontPtr;</span><br><span class="line">    Queue rearPtr;</span><br><span class="line">&#125;LinkQueue;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">initQueue</span><span class="params">(LinkQueue &amp;Q)</span></span>&#123;</span><br><span class="line">    Q.frontPtr  = (QNode*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (QNode));</span><br><span class="line">    Q.rearPtr = Q.frontPtr;</span><br><span class="line">    <span class="keyword">if</span>(!Q.frontPtr) <span class="keyword">return</span> ERROR;</span><br><span class="line">    Q.frontPtr-&gt;next == <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">EnQueue</span><span class="params">(LinkQueue &amp;Q,ElemType e)</span></span>&#123;</span><br><span class="line">    QNode *m = (QNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (QNode));</span><br><span class="line">    <span class="keyword">if</span>(!m) <span class="keyword">return</span> ERROR;</span><br><span class="line">    m-&gt;data = e;</span><br><span class="line">    m-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    Q.rearPtr-&gt;next = m;</span><br><span class="line">    Q.rearPtr = m;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">isEmpty</span><span class="params">(LinkQueue Q)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Q.frontPtr == Q.rearPtr) <span class="keyword">return</span> ERROR;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">DeQueue</span><span class="params">(LinkQueue &amp;Q,ElemType &amp;e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isEmpty(Q)) <span class="keyword">return</span> ERROR;</span><br><span class="line">    QNode *m = Q.frontPtr;</span><br><span class="line">    Q.frontPtr = Q.frontPtr-&gt;next;</span><br><span class="line">    e = m-&gt;data;</span><br><span class="line">    <span class="built_in">free</span>(m);</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="顺序队列"><a href="#顺序队列" class="headerlink" title="顺序队列"></a>顺序队列</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;malloc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LIST_INIT_SIZE 5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LISTINCREMENT 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"></span><br><span class="line"><span class="comment">//typedef struct&#123;</span></span><br><span class="line"><span class="comment">//    char name[8];</span></span><br><span class="line"><span class="comment">//    int age;</span></span><br><span class="line"><span class="comment">//&#125;ElemType;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> ElemType;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXQSIZE 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    ElemType *base;</span><br><span class="line">    <span class="keyword">int</span> front;</span><br><span class="line">    <span class="keyword">int</span> rear;</span><br><span class="line">&#125;Queue;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">isFull</span><span class="params">(Queue &amp;Q)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>((Q.rear - Q.front + MAXQSIZE)%MAXQSIZE &lt; MAXQSIZE - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">initQueue</span><span class="params">(Queue &amp;Q)</span></span>&#123;</span><br><span class="line">    Q.base = (ElemType*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (ElemType)*MAXQSIZE);</span><br><span class="line">    <span class="keyword">if</span>(!Q.base) <span class="keyword">return</span> ERROR;</span><br><span class="line">    Q.front = Q.rear = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">enQueue</span><span class="params">(Queue &amp;Q,ElemType e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isFull(Q)) <span class="keyword">return</span> ERROR;</span><br><span class="line">    Q.base[Q.rear] = e;</span><br><span class="line">    Q.rear = (++Q.rear)%MAXQSIZE;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">deQueue</span><span class="params">(Queue &amp;Q,ElemType &amp;e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Q.rear == Q.front) <span class="keyword">return</span> ERROR;</span><br><span class="line">    e = Q.base[Q.front];</span><br><span class="line">    Q.front = (++Q.front)%MAXQSIZE;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="双端队列"><a href="#双端队列" class="headerlink" title="双端队列"></a>双端队列</h1><p>双端队列：双端队列是一种特殊的线性表，特殊在限定插入 和删除操作只能在表的两端进行。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">GuiYoung</p>
  <div class="site-description" itemprop="description">十有九人堪白眼，百无一用是书生</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GuiYoung</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
